<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Fuel - AI Meal Planner</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="AI-powered nutrition planning for elite athletes. Optimize your meals based on workouts, body composition, and goals.">
    <meta name="theme-color" content="#0A0E1A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Easy Fuel">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icon-167.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #7FE88E;
            --primary-dark: #5DD46E;
            --accent: #FF6B9D;
            --accent-alt: #FFB800;
            --bg-dark: #0A0E1A;
            --bg-card: #141B2D;
            --bg-card-hover: #1A2235;
            --text-primary: #E8EDF4;
            --text-secondary: #8B95A8;
            --border: #252F45;
            --success: #7FE88E;
            --warning: #FFB800;
            --gradient-1: linear-gradient(135deg, #7FE88E 0%, #5DD46E 100%);
            --gradient-2: linear-gradient(135deg, #FF6B9D 0%, #C94277 100%);
            --gradient-accent: linear-gradient(135deg, rgba(127,232,142,0.1) 0%, rgba(255,107,157,0.1) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Archivo', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Header */
        header {
            padding: 2rem 0;
            border-bottom: 1px solid var(--border);
            background: rgba(10, 14, 26, 0.8);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Archivo', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--primary);
        }

        .tab-btn.active {
            background: var(--gradient-1);
            border-color: var(--primary);
            color: var(--bg-dark);
        }

        /* Main Content */
        .main-content {
            padding: 3rem 0;
            min-height: calc(100vh - 150px);
        }

        .view {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Setup View */
        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary);
            transform: translateY(-4px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-accent);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(127, 232, 142, 0.05);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: var(--primary);
            background: rgba(127, 232, 142, 0.05);
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"]:checked + span {
            color: var(--primary);
            font-weight: 600;
        }

        /* Device Sync */
        .device-list {
            display: grid;
            gap: 1rem;
        }

        .device-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .device-card:hover {
            border-color: var(--primary);
        }

        .device-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .device-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--text-secondary);
        }

        .device-status.connected {
            background: var(--success);
            box-shadow: 0 0 12px var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .btn {
            padding: 0.875rem 2rem;
            background: var(--gradient-1);
            border: none;
            border-radius: 12px;
            color: var(--bg-dark);
            font-family: 'Archivo', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(127, 232, 142, 0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--primary);
            box-shadow: none;
        }

        /* Dashboard View */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--gradient-accent);
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        .dashboard-title h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .dashboard-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-1);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-change {
            font-size: 0.875rem;
            color: var(--success);
            margin-top: 0.5rem;
        }

        /* Meal Plan */
        .meal-plan-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
        }

        .week-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .week-nav {
            display: flex;
            gap: 1rem;
        }

        .day-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .day-tab {
            padding: 0.75rem 1.5rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .day-tab:hover {
            border-color: var(--primary);
        }

        .day-tab.active {
            background: var(--gradient-1);
            border-color: var(--primary);
            color: var(--bg-dark);
        }

        .meals-list {
            display: grid;
            gap: 1.5rem;
        }

        .meal-card {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 1.5rem;
            align-items: start;
            transition: all 0.3s ease;
        }

        .meal-card:hover {
            border-color: var(--primary);
            transform: translateX(8px);
        }

        .meal-time {
            text-align: center;
            padding: 0.75rem;
            background: var(--gradient-accent);
            border-radius: 12px;
            min-width: 100px;
        }

        .meal-time-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .meal-time-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .meal-details h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .meal-ingredients {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }

        .meal-macros {
            display: flex;
            gap: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .macro {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .macro-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .macro-dot.protein { background: var(--accent); }
        .macro-dot.carbs { background: var(--accent-alt); }
        .macro-dot.fat { background: var(--primary); }

        .meal-calories {
            text-align: right;
            padding: 1rem;
            background: var(--gradient-accent);
            border-radius: 12px;
        }

        .calories-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .calories-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Shopping List */
        .shopping-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .shopping-categories {
            display: grid;
            gap: 1.5rem;
        }

        .category-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .category-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .item-count {
            background: var(--bg-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .items-list {
            display: grid;
            gap: 0.75rem;
        }

        .shopping-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .shopping-item:hover {
            border-color: var(--primary);
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .item-checkbox.checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        .item-name {
            font-weight: 500;
        }

        .item-amount {
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .item-price {
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .budget-summary {
            background: var(--gradient-accent);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .budget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .budget-stat {
            text-align: center;
        }

        .budget-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .budget-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .budget-value.under {
            color: var(--primary);
        }

        .budget-value.over {
            color: var(--accent);
        }

        .budget-progress {
            width: 100%;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .budget-progress-bar {
            height: 100%;
            background: var(--gradient-1);
            transition: width 0.5s ease;
        }

        .budget-progress-bar.over {
            background: var(--gradient-2);
        }

        /* Onboarding Overlay */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.98);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .onboarding-overlay.active {
            display: flex;
        }

        .onboarding-container {
            max-width: 1200px;
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 3rem;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .onboarding-welcome {
            text-align: center;
            margin-bottom: 3rem;
        }

        .onboarding-logo {
            font-size: 3rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .onboarding-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .onboarding-progress {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 3rem;
        }

        .progress-step {
            width: 60px;
            height: 6px;
            background: var(--bg-dark);
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: var(--gradient-1);
        }

        .onboarding-step {
            display: none;
        }

        .onboarding-step.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        .step-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .step-description {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .onboarding-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .skip-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
        }

        .skip-btn:hover {
            color: var(--text-primary);
        }

        .onboarding-actions {
            display: flex;
            gap: 1rem;
        }

        .welcome-card {
            background: var(--gradient-accent);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .feature-item {
            display: flex;
            align-items: start;
            gap: 1rem;
        }

        .feature-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .feature-text h4 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .feature-text p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .setup-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .meal-card {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }

        /* iPhone-Specific Optimizations */
        @media (max-width: 428px) {
            /* iPhone 14 Pro Max and smaller */
            
            body {
                font-size: 15px;
            }

            .container {
                padding: 0 1rem;
            }

            /* Header adjustments */
            header {
                padding: 1rem 0;
            }

            .logo {
                font-size: 1.5rem;
            }

            .nav-tabs {
                width: 100%;
                overflow-x: auto;
                flex-wrap: nowrap;
                gap: 0.5rem;
                padding-bottom: 0.5rem;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .nav-tabs::-webkit-scrollbar {
                display: none;
            }

            .tab-btn {
                padding: 0.625rem 1rem;
                font-size: 0.875rem;
                white-space: nowrap;
                flex-shrink: 0;
            }

            /* Main content spacing */
            .main-content {
                padding: 1.5rem 0;
            }

            /* Cards */
            .card {
                padding: 1.25rem;
                border-radius: 16px;
            }

            .card-title {
                font-size: 1.1rem;
            }

            .card-icon {
                width: 40px;
                height: 40px;
                font-size: 1.25rem;
            }

            /* Dashboard */
            .dashboard-header {
                padding: 1.25rem;
            }

            .dashboard-title h1 {
                font-size: 1.5rem;
            }

            .dashboard-subtitle {
                font-size: 0.9rem;
            }

            /* Stats */
            .stat-value {
                font-size: 1.75rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            /* Workout Calendar - Stack on mobile */
            .workout-calendar {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .day-column {
                min-height: auto;
            }

            /* Workout templates - Better mobile grid */
            .workout-templates {
                grid-template-columns: 1fr;
            }

            .workout-template {
                padding: 1.25rem;
            }

            .template-title {
                font-size: 1rem;
            }

            /* Nutrition strategy grid */
            .strategy-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            /* Meal plan */
            .week-selector {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .week-nav {
                width: 100%;
                justify-content: space-between;
            }

            .day-tabs {
                gap: 0.375rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .day-tabs::-webkit-scrollbar {
                display: none;
            }

            .day-tab {
                padding: 0.625rem 1rem;
                font-size: 0.875rem;
                flex-shrink: 0;
            }

            .meal-card {
                padding: 1rem;
            }

            .meal-time {
                min-width: 80px;
            }

            .meal-time-value {
                font-size: 1.1rem;
            }

            .meal-details h3 {
                font-size: 1.1rem;
            }

            .meal-ingredients {
                font-size: 0.85rem;
            }

            .calories-value {
                font-size: 1.5rem;
            }

            /* Shopping list */
            .shopping-list-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .shopping-list-header > div:last-child {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .budget-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .budget-value {
                font-size: 1.5rem;
            }

            .shopping-item {
                padding: 0.875rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            /* Onboarding */
            .onboarding-container {
                padding: 1.5rem;
                max-height: 95vh;
            }

            .onboarding-logo {
                font-size: 2rem;
            }

            .onboarding-subtitle {
                font-size: 1rem;
            }

            .step-title {
                font-size: 1.5rem;
            }

            .step-description {
                font-size: 0.9rem;
            }

            .welcome-features {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .feature-icon {
                font-size: 1.5rem;
            }

            .onboarding-nav {
                flex-direction: column;
                gap: 1rem;
            }

            .skip-btn {
                align-self: center;
            }

            .onboarding-actions {
                width: 100%;
                flex-direction: column;
            }

            .onboarding-actions button {
                width: 100%;
            }

            /* Food preferences in onboarding */
            .checkbox-group {
                grid-template-columns: 1fr;
            }

            /* Modals */
            .modal-content {
                padding: 1.5rem;
                max-width: 100%;
                margin: 1rem;
            }

            .modal-title {
                font-size: 1.25rem;
            }

            /* Buttons */
            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                width: 100%;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
            }

            /* Form inputs */
            input, select, textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Touch-friendly tap targets */
            .checkbox-item {
                min-height: 44px;
                padding: 0.875rem;
            }

            .device-card button,
            .shopping-item .item-checkbox {
                min-width: 44px;
                min-height: 44px;
            }
        }

        /* iPhone SE and smaller (very small screens) */
        @media (max-width: 375px) {
            .logo {
                font-size: 1.25rem;
            }

            .tab-btn {
                padding: 0.5rem 0.875rem;
                font-size: 0.8rem;
            }

            .card {
                padding: 1rem;
            }

            .dashboard-title h1 {
                font-size: 1.25rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .strategy-grid {
                grid-template-columns: 1fr;
            }

            .budget-grid {
                grid-template-columns: 1fr;
            }

            .meal-macros {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Landscape mode on iPhone */
        @media (max-height: 500px) and (orientation: landscape) {
            .onboarding-container {
                max-height: 95vh;
                overflow-y: auto;
            }

            .modal-content {
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        /* iPhone notch support (safe area insets) */
        @supports (padding: max(0px)) {
            header {
                padding-left: max(2rem, env(safe-area-inset-left));
                padding-right: max(2rem, env(safe-area-inset-right));
            }

            .container {
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
            }

            .main-content {
                padding-bottom: max(3rem, env(safe-area-inset-bottom));
            }

            .onboarding-container {
                padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
            }
        }

        /* Auth Screen Styles */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .auth-overlay.active {
            display: flex;
        }

        .auth-container {
            max-width: 450px;
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 3rem;
            animation: slideUp 0.5s ease;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo-text {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .auth-tagline {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: var(--bg-dark);
            padding: 0.5rem;
            border-radius: 12px;
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Archivo', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: var(--gradient-1);
            color: var(--bg-dark);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-error {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 0.875rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: none;
        }

        .auth-error.show {
            display: block;
        }

        .password-field {
            position: relative;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-dark);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .user-avatar:hover {
            transform: scale(1.1);
        }

        .user-dropdown {
            position: absolute;
            top: 55px;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            min-width: 220px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
        }

        .user-dropdown.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .user-dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .user-dropdown-name {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .user-dropdown-email {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .user-dropdown-item {
            padding: 0.875rem 1rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
        }

        .user-dropdown-item:hover {
            background: rgba(127, 232, 142, 0.05);
        }

        .user-dropdown-item.danger {
            color: var(--accent);
        }

        .user-dropdown-item.danger:hover {
            background: rgba(255, 107, 157, 0.05);
        }

        @media (max-width: 428px) {
            .auth-container {
                padding: 2rem 1.5rem;
                margin: 1rem;
            }

            .auth-logo-text {
                font-size: 2rem;
            }
        }

        /* Mode Selection Styles */
        .mode-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .mode-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(127, 232, 142, 0.2);
        }

        .mode-card.selected {
            border-color: var(--primary);
            background: rgba(127, 232, 142, 0.05);
            box-shadow: 0 0 0 3px rgba(127, 232, 142, 0.2);
        }

        .mode-check {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
            color: transparent;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .mode-card.selected .mode-check {
            background: var(--gradient-1);
            border-color: var(--primary);
            color: var(--bg-dark);
        }

        /* AI Level Selection Styles */
        .ai-level-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-level-card:hover {
            border-color: var(--primary);
            transform: translateX(4px);
            background: rgba(127, 232, 142, 0.03);
        }

        .ai-level-card.selected {
            border-color: var(--primary);
            background: rgba(127, 232, 142, 0.08);
            box-shadow: 0 0 0 2px rgba(127, 232, 142, 0.2);
        }

        .ai-radio {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: transparent;
            transition: all 0.3s ease;
            flex-shrink: 0;
            margin-top: 0.25rem;
        }

        .ai-level-card.selected .ai-radio {
            background: var(--gradient-1);
            border-color: var(--primary);
            color: var(--bg-dark);
        }

        .ai-level-card.selected .ai-radio::before {
            content: '●';
            font-size: 0.75rem;
        }

        /* Diet Quality Selection Styles */
        .diet-quality-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .diet-quality-card:hover {
            border-color: var(--primary);
            transform: translateX(4px);
            background: rgba(127, 232, 142, 0.03);
        }

        .diet-quality-card.selected {
            border-color: var(--primary);
            background: rgba(127, 232, 142, 0.08);
            box-shadow: 0 0 0 2px rgba(127, 232, 142, 0.2);
        }

        .quality-radio {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: transparent;
            transition: all 0.3s ease;
            flex-shrink: 0;
            margin-top: 0.25rem;
        }

        .diet-quality-card.selected .quality-radio {
            background: var(--gradient-1);
            border-color: var(--primary);
            color: var(--bg-dark);
        }

        .diet-quality-card.selected .quality-radio::before {
            content: '●';
            font-size: 0.75rem;
        }


        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .progress-indicator {
            width: 100%;
            height: 4px;
            background: var(--bg-dark);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-1);
            transition: width 0.5s ease;
        }

        /* Workout Scheduler */
        .workout-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .day-column {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1rem;
            min-height: 400px;
        }

        .day-header {
            text-align: center;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .day-name {
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .day-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .workout-slot {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .workout-slot:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .workout-type-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .workout-type-badge.strength {
            background: rgba(255, 107, 157, 0.2);
            color: var(--accent);
        }

        .workout-type-badge.cardio {
            background: rgba(0, 217, 163, 0.2);
            color: var(--primary);
        }

        .workout-type-badge.hiit {
            background: rgba(255, 184, 0, 0.2);
            color: var(--accent-alt);
        }

        .workout-type-badge.yoga {
            background: rgba(139, 149, 168, 0.2);
            color: var(--text-secondary);
        }

        .workout-type-badge.rest {
            background: rgba(139, 149, 168, 0.1);
            color: var(--text-secondary);
        }

        .workout-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .workout-details {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .workout-time {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .add-workout-btn {
            width: 100%;
            padding: 0.75rem;
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Archivo', sans-serif;
            font-weight: 500;
        }

        .add-workout-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(127, 232, 142, 0.05);
        }

        /* Workout Library */
        .workout-library {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .workout-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .workout-template {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .workout-template:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .template-icon {
            font-size: 2rem;
        }

        .template-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .template-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .template-macros {
            display: flex;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
        }

        .macro-suggestion {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .macro-label-small {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .macro-value-small {
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Nutrition Strategy Panel */
        .nutrition-strategy {
            background: var(--gradient-accent);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .strategy-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .strategy-day {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .strategy-focus {
            color: var(--primary);
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .strategy-macros {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Modal for adding workouts */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-modal {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        @media (max-width: 1200px) {
            .workout-calendar {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            padding: 0.5rem 0;
            z-index: 3000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .bottom-nav-container {
            display: flex;
            justify-content: space-around;
            max-width: 600px;
            margin: 0 auto;
        }

        .bottom-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.75rem;
            min-width: 60px;
        }

        .bottom-nav-btn .nav-icon {
            font-size: 1.5rem;
        }

        .bottom-nav-btn.active {
            color: var(--primary);
        }

        .main-content {
            padding-bottom: 80px !important;
        }

    </style>
</head>
<body>
    <!-- Auth Overlay -->
    <div class="auth-overlay active" id="authOverlay">
        <div class="auth-container">
            <div class="auth-logo">
                <div class="auth-logo-text">Easy Fuel</div>
                <div class="auth-tagline">AI-Powered Nutrition for Athletes</div>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required autocomplete="email" placeholder="your@email.com">
                </div>
                <div class="form-group password-field">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password" placeholder="Enter password">
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <input type="checkbox" id="keepLoggedIn" checked style="width: auto; margin: 0;">
                    <label for="keepLoggedIn" style="margin: 0; text-transform: none; font-size: 0.9rem; color: var(--text-secondary);">Keep me logged in</label>
                </div>
                <div id="loginError" class="auth-error"></div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;" onclick="console.log('✅ Login button clicked!');">Login</button>
                
                <!-- Debug Panel -->
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-dark); border-radius: 8px; font-size: 0.85rem;" id="debugPanel">
                    <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--primary);">🔧 Debug Info</div>
                    <div style="color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; line-height: 1.6;">
                        <div>Users in DB: <span id="debugUserCount">0</span></div>
                        <div>Current User: <span id="debugCurrentUser">None</span></div>
                        <div>localStorage Works: <span id="debugLocalStorage">Testing...</span></div>
                        <button onclick="testLocalStorage()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: var(--primary); color: var(--bg-dark); border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            🔍 Test Storage
                        </button>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                    Don't have an account? <span class="auth-link" onclick="switchAuthTab('signup')">Sign up</span>
                </div>
            </form>

            <!-- Signup Form -->
            <form class="auth-form" id="signupForm" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="signupName" required autocomplete="name" placeholder="Your name">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" required autocomplete="email" placeholder="your@email.com">
                </div>
                <div class="form-group password-field">
                    <label>Password</label>
                    <input type="password" id="signupPassword" required autocomplete="new-password" minlength="6" placeholder="At least 6 characters">
                </div>
                <div class="form-group password-field">
                    <label>Confirm Password</label>
                    <input type="password" id="signupPasswordConfirm" required autocomplete="new-password" placeholder="Confirm password">
                </div>
                <div id="signupError" class="auth-error"></div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;">Create Account</button>
                <div style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                    Already have an account? <span class="auth-link" onclick="switchAuthTab('login')">Login</span>
                </div>
            </form>
        </div>
    </div>

    <!-- Onboarding Overlay -->
    <div class="onboarding-overlay active" id="onboardingOverlay">
        <div class="onboarding-container">
            <!-- Progress Indicator -->
            <div class="onboarding-progress">
                <div class="progress-step active" data-step="0"></div>
                <div class="progress-step" data-step="1"></div>
                <div class="progress-step" data-step="2"></div>
                <div class="progress-step" data-step="3"></div>
                <div class="progress-step" data-step="4"></div>
                <div class="progress-step" data-step="5"></div>
                <div class="progress-step" data-step="6"></div>
                <div class="progress-step" data-step="7"></div>
            </div>

            <!-- Step 0: Mode Selection -->
            <div class="onboarding-step active" data-step="0">
                <div class="onboarding-welcome">
                    <div class="onboarding-logo">Welcome to Easy Fuel</div>
                    <div class="onboarding-subtitle">AI-Powered Nutrition for Athletes</div>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h2 style="text-align: center; margin-bottom: 1rem; font-size: 1.75rem;">Choose Your Experience</h2>
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                        Select how you want to use Easy Fuel based on your training style and nutrition goals
                    </p>
                </div>

                <!-- Mode Cards -->
                <div style="display: grid; gap: 1.5rem; margin-bottom: 2rem;">
                    <!-- Casual Mode -->
                    <div class="mode-card" onclick="selectMainMode('casual')" id="casualModeCard">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">🍎</div>
                                <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Casual Mode</h3>
                                <p style="color: var(--text-secondary); font-size: 0.95rem;">Perfect for everyday fitness enthusiasts</p>
                            </div>
                            <div class="mode-check" id="casualModeCheck">✓</div>
                        </div>
                        
                        <div style="padding: 1.25rem; background: var(--bg-dark); border-radius: 12px; margin-bottom: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.75rem; color: var(--primary);">What's Included:</div>
                            <ul style="list-style: none; padding: 0; margin: 0; display: grid; gap: 0.5rem;">
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--primary);">✓</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Simple meal planning & calorie tracking</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--primary);">✓</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Basic macro guidance (protein, carbs, fats)</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--primary);">✓</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Weekly shopping lists with budgets</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--primary);">✓</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Food preference customization</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center; padding: 0.75rem; background: rgba(127, 232, 142, 0.1); border-radius: 8px;">
                            <span style="font-weight: 600; color: var(--primary);">Best for:</span>
                            <span style="color: var(--text-secondary); font-size: 0.9rem;"> General fitness, weight management, healthy eating</span>
                        </div>
                    </div>

                    <!-- Pro Mode -->
                    <div class="mode-card" onclick="selectMainMode('pro')" id="proModeCard">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 2rem;">⚡</div>
                                    <div style="background: var(--gradient-2); color: white; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 700;">RECOMMENDED</div>
                                </div>
                                <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Pro Mode</h3>
                                <p style="color: var(--text-secondary); font-size: 0.95rem;">For serious athletes & competitive training</p>
                            </div>
                            <div class="mode-check" id="proModeCheck">✓</div>
                        </div>
                        
                        <div style="padding: 1.25rem; background: var(--bg-dark); border-radius: 12px; margin-bottom: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.75rem; color: var(--primary);">Everything in Casual, plus:</div>
                            <ul style="list-style: none; padding: 0; margin: 0; display: grid; gap: 0.5rem;">
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--accent);">★</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Workout-based nutrition (auto-adjust macros)</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--accent);">★</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Sport science-backed recommendations</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--accent);">★</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Pre/post-workout meal timing</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 0.5rem;">
                                    <span style="color: var(--accent);">★</span>
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Advanced AI meal planning options</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center; padding: 0.75rem; background: rgba(255, 107, 157, 0.1); border-radius: 8px;">
                            <span style="font-weight: 600; color: var(--accent);">Best for:</span>
                            <span style="color: var(--text-secondary); font-size: 0.9rem;"> Competitive athletes, serious training, performance goals</span>
                        </div>
                    </div>
                </div>

                <!-- AI Customization Panel (Shows when Pro is selected) -->
                <div id="aiCustomizationPanel" style="display: none; margin-top: 2rem; padding: 2rem; background: var(--gradient-accent); border-radius: 16px; border: 2px solid var(--primary);">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">⚙️ Customize Your AI Experience</h3>
                        <p style="color: var(--text-secondary); font-size: 0.95rem;">
                            Choose how much control you want over your meal planning
                        </p>
                    </div>

                    <div style="display: grid; gap: 1.25rem;">
                        <!-- AI Level 1: Adjust Existing -->
                        <div class="ai-level-card" onclick="selectAILevel('adjust')" id="aiAdjust">
                            <div style="display: flex; gap: 1rem;">
                                <div class="ai-radio" id="aiAdjustRadio">○</div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <span style="font-size: 1.5rem;">🔧</span>
                                        <h4 style="font-size: 1.1rem; font-weight: 700;">Adjust My Current Meals</h4>
                                    </div>
                                    <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem;">
                                        Keep eating what you already eat. AI will adjust portion sizes, timing, and macros to meet your calorie and exercise demands.
                                    </p>
                                    <div style="background: rgba(127, 232, 142, 0.1); padding: 0.75rem; border-radius: 8px; border-left: 3px solid var(--primary);">
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                            <strong style="color: var(--primary);">You control:</strong> What foods you eat<br>
                                            <strong style="color: var(--primary);">AI optimizes:</strong> Portions, timing, macros
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Level 2: Create from Schedule -->
                        <div class="ai-level-card" onclick="selectAILevel('schedule')" id="aiSchedule">
                            <div style="display: flex; gap: 1rem;">
                                <div class="ai-radio" id="aiScheduleRadio">○</div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <span style="font-size: 1.5rem;">📅</span>
                                        <h4 style="font-size: 1.1rem; font-weight: 700;">Build from My Workout Schedule</h4>
                                        <div style="background: var(--gradient-2); color: white; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.7rem; font-weight: 700;">POPULAR</div>
                                    </div>
                                    <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem;">
                                        Tell AI your workout schedule and food preferences. It creates complete meal plans optimized for each training day.
                                    </p>
                                    <div style="background: rgba(255, 184, 0, 0.1); padding: 0.75rem; border-radius: 8px; border-left: 3px solid var(--accent-alt);">
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                            <strong style="color: var(--accent-alt);">You control:</strong> Workout schedule, food preferences<br>
                                            <strong style="color: var(--accent-alt);">AI creates:</strong> Complete meal plans, recipes, shopping lists
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Level 3: Full AI Control -->
                        <div class="ai-level-card" onclick="selectAILevel('full')" id="aiFull">
                            <div style="display: flex; gap: 1rem;">
                                <div class="ai-radio" id="aiFullRadio">○</div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <span style="font-size: 1.5rem;">🤖</span>
                                        <h4 style="font-size: 1.1rem; font-weight: 700;">Full AI Optimization</h4>
                                    </div>
                                    <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem;">
                                        AI builds everything from scratch based on your goals, body stats, and lifestyle. You can tweak and AI adapts in real-time.
                                    </p>
                                    <div style="background: rgba(255, 107, 157, 0.1); padding: 0.75rem; border-radius: 8px; border-left: 3px solid var(--accent);">
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                            <strong style="color: var(--accent);">You control:</strong> Goals, preferences, real-time tweaks<br>
                                            <strong style="color: var(--accent);">AI creates:</strong> Everything - workouts, meals, timing, recovery
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-dark); border-radius: 8px; text-align: center;">
                        <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">
                            💡 Don't worry - you can change this anytime in Settings
                        </p>
                    </div>
                </div>

                <div style="background: var(--bg-dark); padding: 1.25rem; border-radius: 12px; border: 1px solid var(--border);">
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0; text-align: center;">
                        💡 Don't worry - you can always switch modes later in Settings
                    </p>
                </div>
            </div>

            <!-- Step 1: Simple Profile -->
            <div class="onboarding-step" data-step="1">
                <div class="step-title">Welcome! Let's Start with the Basics</div>
                <div class="step-description">Tell us about yourself so we can personalize your nutrition plan</div>
                
                <div style="max-width: 500px; margin: 0 auto;">
                    <div class="form-group">
                        <label>What's your name?</label>
                        <input type="text" id="onboarding-name" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" id="onboarding-age" placeholder="Age" min="13" max="120" required>
                    </div>
                    <div class="form-group">
                        <label>Weight (lbs)</label>
                        <input type="number" id="onboarding-weight" placeholder="Current weight" min="50" max="500" required>
                    </div>
                    <div class="form-group">
                        <label>Height (inches)</label>
                        <input type="number" id="onboarding-height" placeholder="Height in inches" min="36" max="96" required>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            💡 Tip: 5'10" = 70 inches, 6'0" = 72 inches
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Mode Selection -->
            <div class="onboarding-step" data-step="2">
                <div class="step-title">Choose Your Mode</div>
                <div class="step-description">How would you like to use Easy Fuel?</div>
                
                <div style="display: grid; gap: 1.5rem; max-width: 800px; margin: 0 auto;">
                    <!-- Casual Mode -->
                    <div class="mode-card" onclick="selectMainMode('casual')" id="casualModeCard">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">🍎</div>
                                <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Casual Mode</h3>
                                <p style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 1rem;">
                                    Simple meal planning and calorie tracking for everyday fitness
                                </p>
                                <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                    ✓ Basic meal plans<br>
                                    ✓ Calorie tracking<br>
                                    ✓ Shopping lists with budgets
                                </div>
                            </div>
                            <div class="mode-check" id="casualModeCheck">✓</div>
                        </div>
                    </div>

                    <!-- Pro Mode -->
                    <div class="mode-card" onclick="selectMainMode('pro')" id="proModeCard">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 2rem;">⚡</div>
                                    <div style="background: var(--gradient-2); color: white; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 700;">RECOMMENDED</div>
                                </div>
                                <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Pro Mode</h3>
                                <p style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 1rem;">
                                    Advanced features with AI-powered workout nutrition
                                </p>
                                <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                    ★ Everything in Casual<br>
                                    ★ Workout-based nutrition<br>
                                    ★ AI meal planning options<br>
                                    ★ Sport science recommendations
                                </div>
                            </div>
                            <div class="mode-check" id="proModeCheck">✓</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: AI Level (Only shows for Pro mode) -->
            <div class="onboarding-step" data-step="3" id="aiLevelStep">
                <div class="step-title">How Much Should AI Do For You?</div>
                <div class="step-description">Choose your level of AI assistance for meal planning</div>
                
                <div style="display: grid; gap: 1.25rem; max-width: 700px; margin: 0 auto;">
                    <!-- Adjust Existing -->
                    <div class="ai-level-card" onclick="selectAILevel('adjust')" id="aiAdjustCard">
                        <div style="display: flex; gap: 1rem;">
                            <div class="ai-radio" id="aiAdjustRadio">○</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1.5rem;">🔧</span>
                                    <h4 style="font-size: 1.1rem; font-weight: 700;">Adjust My Current Meals</h4>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                                    Keep eating what you already eat. AI adjusts portions, timing, and macros to meet your workout demands.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Build from Schedule -->
                    <div class="ai-level-card" onclick="selectAILevel('schedule')" id="aiScheduleCard">
                        <div style="display: flex; gap: 1rem;">
                            <div class="ai-radio" id="aiScheduleRadio">○</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1.5rem;">📅</span>
                                    <h4 style="font-size: 1.1rem; font-weight: 700;">Build from My Workout Schedule</h4>
                                    <div style="background: var(--gradient-2); color: white; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.7rem; font-weight: 700;">POPULAR</div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                                    Tell AI your workout schedule. It creates complete meal plans optimized for each training day.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Full AI -->
                    <div class="ai-level-card" onclick="selectAILevel('full')" id="aiFullCard">
                        <div style="display: flex; gap: 1rem;">
                            <div class="ai-radio" id="aiFullRadio">○</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1.5rem;">🤖</span>
                                    <h4 style="font-size: 1.1rem; font-weight: 700;">Full AI Optimization</h4>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                                    AI builds everything from scratch. You can tweak and AI adapts in real-time.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Diet Quality -->
            <div class="onboarding-step" data-step="4">
                <div class="step-title">Food Quality Preference</div>
                <div class="step-description">How should we balance cost, quality, and performance in your meal plans?</div>
                
                <div style="display: grid; gap: 1.5rem; max-width: 700px; margin: 0 auto;">
                    <!-- Performance -->
                    <div class="diet-quality-card" onclick="selectDietQuality('performance')" id="qualityPerformance">
                        <div style="display: flex; gap: 1rem;">
                            <div class="quality-radio" id="performanceRadio">○</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1.5rem;">🏆</span>
                                    <h4 style="font-size: 1.1rem; font-weight: 700;">Performance First</h4>
                                    <div style="background: var(--gradient-2); color: white; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.7rem; font-weight: 700;">ATHLETES</div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem;">
                                    Optimal nutrients and calories for peak performance. Balances quality and cost to fuel your training.
                                </p>
                                <div style="background: rgba(255, 184, 0, 0.1); padding: 0.75rem; border-radius: 8px;">
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                        <strong style="color: var(--accent-alt);">Priority:</strong> Right macros at the right time<br>
                                        <strong style="color: var(--accent-alt);">Cost:</strong> Moderate - balanced approach
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Budget/Casual -->
                    <div class="diet-quality-card" onclick="selectDietQuality('budget')" id="qualityBudget">
                        <div style="display: flex; gap: 1rem;">
                            <div class="quality-radio" id="budgetRadio">○</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1.5rem;">💰</span>
                                    <h4 style="font-size: 1.1rem; font-weight: 700;">Budget-Friendly</h4>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem;">
                                    Affordable foods that meet your calorie needs. May sacrifice some quality for cost savings.
                                </p>
                                <div style="background: rgba(127, 232, 142, 0.1); padding: 0.75rem; border-radius: 8px;">
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                        <strong style="color: var(--primary);">Priority:</strong> Lowest cost per calorie<br>
                                        <strong style="color: var(--primary);">Cost:</strong> Low - economy brands and bulk
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Quality -->
                    <div class="diet-quality-card" onclick="selectDietQuality('premium')" id="qualityPremium">
                        <div style="display: flex; gap: 1rem;">
                            <div class="quality-radio" id="premiumRadio">○</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1.5rem;">⭐</span>
                                    <h4 style="font-size: 1.1rem; font-weight: 700;">Premium Quality</h4>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem;">
                                    Highest quality foods - organic, grass-fed, wild-caught. Cost is secondary to quality.
                                </p>
                                <div style="background: rgba(255, 107, 157, 0.1); padding: 0.75rem; border-radius: 8px;">
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                        <strong style="color: var(--accent);">Priority:</strong> Organic, premium ingredients<br>
                                        <strong style="color: var(--accent);">Cost:</strong> High - quality over price
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: Food Exclusions -->
            <div class="onboarding-step" data-step="5">
                <div class="step-title">Food Exclusions</div>
                <div class="step-description">List any foods you want to exclude from your meal plans</div>
                
                <div style="max-width: 700px; margin: 0 auto;">
                    <div style="background: var(--bg-dark); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            💡 <strong style="color: var(--primary);">Keep it simple:</strong> Only list foods you absolutely don't want in your meal plans.
                            We'll work around these to create delicious meals you'll actually enjoy.
                        </p>
                    </div>

                    <div class="form-group">
                        <label>Foods to Exclude</label>
                        <textarea 
                            id="onboarding-exclusions" 
                            rows="6" 
                            placeholder="Example: mushrooms, cilantro, olives, shellfish, cottage cheese&#10;&#10;Separate items with commas or new lines"
                            style="font-family: 'Archivo', sans-serif; line-height: 1.6;"></textarea>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.75rem;">
                            <strong>Examples:</strong>
                            <ul style="margin-top: 0.5rem; padding-left: 1.5rem; line-height: 1.8;">
                                <li>Specific foods: "bananas, eggs, mushrooms"</li>
                                <li>Categories: "all seafood, dairy products"</li>
                                <li>Preparations: "fried foods, raw vegetables"</li>
                            </ul>
                        </div>
                    </div>

                    <div style="background: rgba(127, 232, 142, 0.1); padding: 1.25rem; border-radius: 12px; border-left: 3px solid var(--primary); margin-top: 2rem;">
                        <div style="display: flex; align-items: start; gap: 1rem;">
                            <span style="font-size: 1.5rem;">ℹ️</span>
                            <div>
                                <div style="font-weight: 600; color: var(--primary); margin-bottom: 0.5rem;">
                                    Don't worry about preferences
                                </div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                                    You only need to list foods you <strong>don't</strong> want. Our AI will automatically recommend 
                                    a variety of nutritious foods based on your goals, diet quality, and what's available in your area.
                                    You can always adjust meal suggestions in the app.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-dark); border-radius: 8px; text-align: center;">
                        <button 
                            onclick="document.getElementById('onboarding-exclusions').value = ''" 
                            style="background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                            Clear All
                        </button>
                        <span style="color: var(--text-secondary); font-size: 0.85rem; margin-left: 1rem;">
                            Leave blank if you're open to everything
                        </span>
                    </div>
                </div>
            </div>

            <!-- Step 6: Allergies & Restrictions -->
            <div class="onboarding-step" data-step="6">
                <div class="step-title">Dietary Restrictions</div>
                <div class="step-description">Let us know about any allergies, intolerances, or foods you prefer to avoid</div>
                
                <div class="form-group">
                    <label>Allergies (critical - we'll never suggest these)</label>
                    <textarea id="onboarding-allergies" rows="3" placeholder="e.g., peanuts, shellfish, dairy, bananas, eggs"></textarea>
                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        🚨 Be thorough here - these foods will be completely excluded from all meal plans
                    </div>
                </div>

                <div class="form-group">
                    <label>Foods You Dislike (preferences - we'll avoid when possible)</label>
                    <textarea id="onboarding-dislikes" rows="3" placeholder="e.g., mushrooms, cilantro, brussels sprouts"></textarea>
                </div>

                <div class="form-group">
                    <label>Special Dietary Approaches</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" class="onboard-diet" value="vegetarian">
                            <span>Vegetarian</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="onboard-diet" value="vegan">
                            <span>Vegan</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="onboard-diet" value="keto">
                            <span>Keto/Low-Carb</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="onboard-diet" value="paleo">
                            <span>Paleo</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="onboard-diet" value="glutenfree">
                            <span>Gluten-Free</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="onboard-diet" value="dairyfree">
                            <span>Dairy-Free</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Step 7: Shopping & Location -->
            <div class="onboarding-step" data-step="7">
                <div class="step-title">Shopping Preferences</div>
                <div class="step-description">Enable location to find nearby grocery stores with accurate pricing and stock</div>
                
                <div style="max-width: 800px; margin: 0 auto;">
                    <!-- Location Permission Card -->
                    <div style="background: var(--gradient-accent); padding: 2rem; border-radius: 16px; margin-bottom: 2rem; border: 2px solid var(--primary);">
                        <div style="display: flex; align-items: start; gap: 1.5rem;">
                            <span style="font-size: 3rem;">📍</span>
                            <div style="flex: 1;">
                                <h3 style="margin-bottom: 0.75rem; font-size: 1.25rem;">Enable Location Services</h3>
                                <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                                    Allow location access to automatically find grocery stores near you with:
                                </p>
                                <ul style="color: var(--text-secondary); line-height: 1.8; margin-bottom: 1.5rem;">
                                    <li>✓ Real-time store hours and distances</li>
                                    <li>✓ Actual product availability at nearby locations</li>
                                    <li>✓ Accurate local pricing (not national averages)</li>
                                    <li>✓ Restaurant recommendations based on your diet</li>
                                </ul>
                                <button 
                                    onclick="requestLocation()" 
                                    id="locationButton"
                                    class="btn" 
                                    style="width: auto; padding: 0.875rem 2rem; font-size: 1rem;">
                                    <span id="locationButtonText">📍 Enable Location</span>
                                </button>
                                <div id="locationStatus" style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Current Location Display -->
                    <div id="locationDisplay" style="display: none; margin-bottom: 2rem;">
                        <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">📍 Your Location</div>
                                    <div id="locationAddress" style="color: var(--text-secondary); font-size: 0.9rem;">Loading...</div>
                                </div>
                                <button onclick="requestLocation()" style="background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                                    Update
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Nearby Grocery Stores -->
                    <div id="nearbyStoresSection" style="display: none;">
                        <h3 style="margin-bottom: 1rem; font-size: 1.25rem;">🛒 Grocery Stores Near You</h3>
                        <div style="background: var(--bg-dark); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">
                                Select your primary store. We'll use their actual prices and stock for meal planning.
                            </p>
                        </div>
                        <div id="storesList" style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                            <!-- Stores will be populated here -->
                        </div>
                    </div>

                    <!-- Manual Store Selection (Fallback) -->
                    <div id="manualStoreSection">
                        <h3 style="margin-bottom: 1rem; font-size: 1.25rem;">Or Choose From List</h3>
                        <div class="form-group">
                            <label>Primary Grocery Store</label>
                            <select id="onboarding-store">
                                <option value="">Select your store</option>
                                <optgroup label="Premium / Specialty">
                                    <option value="wholefoods">Whole Foods Market</option>
                                    <option value="trader">Trader Joe's</option>
                                    <option value="sprouts">Sprouts Farmers Market</option>
                                    <option value="freshthyme">Fresh Thyme</option>
                                    <option value="earthfare">Earth Fare</option>
                                    <option value="naturalgrocer">Natural Grocers</option>
                                    <option value="thefrsh">The Fresh Market</option>
                                </optgroup>
                                <optgroup label="Major Supermarkets">
                                    <option value="kroger">Kroger</option>
                                    <option value="safeway">Safeway</option>
                                    <option value="albertsons">Albertsons</option>
                                    <option value="publix">Publix</option>
                                    <option value="giant">Giant Food</option>
                                    <option value="stopshop">Stop & Shop</option>
                                    <option value="foodlion">Food Lion</option>
                                    <option value="harristeeter">Harris Teeter</option>
                                    <option value="meijer">Meijer</option>
                                    <option value="wegmans">Wegmans</option>
                                    <option value="hannaford">Hannaford</option>
                                    <option value="shoprite">ShopRite</option>
                                    <option value="vons">Vons</option>
                                    <option value="raleys">Raley's</option>
                                    <option value="kingkullen">King Kullen</option>
                                </optgroup>
                                <optgroup label="Discount / Value">
                                    <option value="aldi">Aldi</option>
                                    <option value="lidl">Lidl</option>
                                    <option value="savemart">Save Mart</option>
                                    <option value="foodmaxx">FoodMaxx</option>
                                    <option value="winco">WinCo Foods</option>
                                    <option value="smartfinal">Smart & Final</option>
                                    <option value="grocery outlet">Grocery Outlet</option>
                                </optgroup>
                                <optgroup label="Warehouse Clubs">
                                    <option value="costco">Costco</option>
                                    <option value="samsclub">Sam's Club</option>
                                    <option value="bjs">BJ's Wholesale</option>
                                </optgroup>
                                <optgroup label="Supercenters">
                                    <option value="walmart">Walmart Supercenter</option>
                                    <option value="target">Target</option>
                                    <option value="fred meyer">Fred Meyer</option>
                                    <option value="heb">H-E-B</option>
                                    <option value="hyvee">Hy-Vee</option>
                                </optgroup>
                                <optgroup label="Regional Chains - East Coast">
                                    <option value="acme">Acme Markets</option>
                                    <option value="shoprite">ShopRite</option>
                                    <option value="kings">Kings Food Markets</option>
                                    <option value="stew">Stew Leonard's</option>
                                    <option value="market basket">Market Basket</option>
                                    <option value="price chopper">Price Chopper</option>
                                </optgroup>
                                <optgroup label="Regional Chains - South">
                                    <option value="winn dixie">Winn-Dixie</option>
                                    <option value="piggly wiggly">Piggly Wiggly</option>
                                    <option value="bi-lo">BI-LO</option>
                                    <option value="ingles">Ingles Markets</option>
                                    <option value="lowes foods">Lowes Foods</option>
                                </optgroup>
                                <optgroup label="Regional Chains - Midwest">
                                    <option value="jewel">Jewel-Osco</option>
                                    <option value="schnucks">Schnucks</option>
                                    <option value="dierbergs">Dierbergs</option>
                                    <option value="festival">Festival Foods</option>
                                    <option value="woodmans">Woodman's</option>
                                    <option value="buehlers">Buehler's</option>
                                </optgroup>
                                <optgroup label="Regional Chains - West">
                                    <option value="ralphs">Ralphs</option>
                                    <option value="pavilions">Pavilions</option>
                                    <option value="smiths">Smith's Food & Drug</option>
                                    <option value="frys">Fry's Food Stores</option>
                                    <option value="qfc">QFC (Quality Food Centers)</option>
                                    <option value="albertsons west">Albertsons (West)</option>
                                </optgroup>
                                <optgroup label="Asian / International">
                                    <option value="hmart">H Mart</option>
                                    <option value="99ranch">99 Ranch Market</option>
                                    <option value="lotte">Lotte Plaza</option>
                                    <option value="seafood city">Seafood City</option>
                                    <option value="mitsuwa">Mitsuwa Marketplace</option>
                                </optgroup>
                                <optgroup label="Other">
                                    <option value="other">Other / Local Store</option>
                                </optgroup>
                            </select>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.75rem;">
                                Can't find your store? Select "Other" and we'll use general pricing
                            </div>
                        </div>
                    </div>

                    <!-- Budget Settings -->
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                        <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem;">💰 Budget</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div class="form-group">
                                <label>Budget Type</label>
                                <select id="onboarding-budget-type">
                                    <option value="weekly">Weekly Budget</option>
                                    <option value="daily">Daily Budget</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Budget Amount ($)</label>
                                <input type="number" id="onboarding-budget" placeholder="e.g., 150" min="0" step="10">
                            </div>

                            <div class="form-group">
                                <label>Shopping Frequency</label>
                                <select id="onboarding-trips">
                                    <option value="1">Once a week</option>
                                    <option value="2">Twice a week</option>
                                    <option value="3">3 times a week</option>
                                    <option value="4">4+ times a week</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Notice -->
                    <div style="margin-top: 2rem; padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <span style="font-size: 1.25rem;">🔒</span>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
                                <strong style="color: var(--text-primary);">Privacy:</strong> Your location is only used to find nearby stores and is never stored or shared. 
                                You can disable location services at any time in Settings.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 8: Device Sync & Bluetooth -->
            <div class="onboarding-step" data-step="7">
                <div class="step-title">Connect Your Devices (Optional)</div>
                <div class="step-description">Sync your fitness tracker for automatic calorie tracking and workout detection</div>
                
                <div style="background: var(--gradient-accent); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                    <p style="color: var(--text-secondary); line-height: 1.7;">
                        💡 Connecting your watch or fitness tracker allows Easy Fuel to automatically adjust your nutrition 
                        based on actual calories burned, heart rate data, and workout intensity. This is optional but highly recommended 
                        for the best results.
                    </p>
                </div>

                <div class="device-list">
                    <div class="device-card">
                        <div class="device-info">
                            <div class="device-status"></div>
                            <div>
                                <div style="font-weight: 600;">Apple Watch</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Sync workouts, heart rate, and calories</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Connect</button>
                    </div>
                    <div class="device-card">
                        <div class="device-info">
                            <div class="device-status"></div>
                            <div>
                                <div style="font-weight: 600;">Fitbit</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Sync workouts, heart rate, and calories</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Connect</button>
                    </div>
                    <div class="device-card">
                        <div class="device-info">
                            <div class="device-status"></div>
                            <div>
                                <div style="font-weight: 600;">Garmin</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Sync workouts, heart rate, and calories</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Connect</button>
                    </div>
                    <div class="device-card">
                        <div class="device-info">
                            <div class="device-status"></div>
                            <div>
                                <div style="font-weight: 600;">Whoop</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Sync strain, recovery, and sleep data</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Connect</button>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem; padding: 1.5rem; background: var(--bg-dark); border-radius: 12px;">
                    <p style="color: var(--text-secondary);">
                        You can always connect devices later from the Settings page
                    </p>
                </div>
            </div>

            <!-- Navigation -->
            <div class="onboarding-nav">
                <button class="skip-btn" onclick="skipOnboarding()">Skip for now</button>
                <div class="onboarding-actions">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">← Back</button>
                    <button class="btn" id="nextBtn" onclick="nextStep()">Continue →</button>
                    <button class="btn" id="finishBtn" onclick="finishOnboarding()" style="display: none;">🚀 Start Using Easy Fuel</button>
                </div>
            </div>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Easy Fuel</div>
                <nav class="nav-tabs">
                    <button class="tab-btn active" data-view="setup">Setup</button>
                    <button class="tab-btn" data-view="workouts">Workouts</button>
                    <button class="tab-btn" data-view="dashboard">Dashboard</button>
                    <button class="tab-btn" data-view="mealplan">Meal Plan</button>
                    <button class="tab-btn" data-view="shopping">Shopping List</button>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Setup View -->
            <!-- Home / Today's Meal Plan View -->
            <div class="view active" id="setup">
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <h1>Today's Meal Plan</h1>
                        <p class="dashboard-subtitle" id="todayDateDisplay">Monday, February 23, 2026</p>
                    </div>
                </div>

                <!-- Today's Workout -->
                <div class="card" style="margin-bottom: 2rem; background: var(--gradient-accent);">
                    <div class="card-header">
                        <div class="card-icon">💪</div>
                        <h2 class="card-title">Today's Workout</h2>
                    </div>
                    <div id="todayWorkout" style="font-size: 1rem;">
                        <div style="padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Upper Body Strength</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                60 minutes • High intensity • ~480 calories
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Meal Cards -->
                <div style="display: grid; gap: 1.5rem; margin-bottom: 2rem;" id="todayMeals">
                    <!-- Breakfast -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">🌅</div>
                            <h2 class="card-title">Breakfast</h2>
                            <div style="margin-left: auto; font-family: 'JetBrains Mono', monospace; color: var(--primary); font-weight: 700;">
                                650 cal
                            </div>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; font-size: 1.05rem; margin-bottom: 0.75rem;">Oatmeal Power Bowl</div>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8; margin: 0; padding-left: 1.5rem;">
                                    <li>1 cup oats (cooked)</li>
                                    <li>1 scoop vanilla protein powder</li>
                                    <li>1 banana, sliced</li>
                                    <li>2 tbsp almond butter</li>
                                    <li>1 tbsp honey</li>
                                    <li>Cinnamon to taste</li>
                                </ul>
                            </div>
                            <div style="display: flex; gap: 1.5rem; padding: 0.875rem; background: var(--bg-dark); border-radius: 8px; font-size: 0.95rem; font-family: 'JetBrains Mono', monospace;">
                                <div><strong style="color: var(--accent);">P:</strong> 35g</div>
                                <div><strong style="color: var(--accent-alt);">C:</strong> 85g</div>
                                <div><strong style="color: var(--primary);">F:</strong> 22g</div>
                            </div>
                        </div>
                    </div>

                    <!-- Pre-Workout Snack -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">⚡</div>
                            <h2 class="card-title">Pre-Workout Snack</h2>
                            <div style="margin-left: auto; font-family: 'JetBrains Mono', monospace; color: var(--primary); font-weight: 700;">
                                250 cal
                            </div>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; font-size: 1.05rem; margin-bottom: 0.75rem;">Quick Energy Boost</div>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8; margin: 0; padding-left: 1.5rem;">
                                    <li>1 medium apple</li>
                                    <li>2 tbsp peanut butter</li>
                                    <li>1 rice cake</li>
                                </ul>
                            </div>
                            <div style="display: flex; gap: 1.5rem; padding: 0.875rem; background: var(--bg-dark); border-radius: 8px; font-size: 0.95rem; font-family: 'JetBrains Mono', monospace;">
                                <div><strong style="color: var(--accent);">P:</strong> 8g</div>
                                <div><strong style="color: var(--accent-alt);">C:</strong> 35g</div>
                                <div><strong style="color: var(--primary);">F:</strong> 11g</div>
                            </div>
                        </div>
                    </div>

                    <!-- Post-Workout Meal -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">🍗</div>
                            <h2 class="card-title">Post-Workout Meal</h2>
                            <div style="margin-left: auto; font-family: 'JetBrains Mono', monospace; color: var(--primary); font-weight: 700;">
                                750 cal
                            </div>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; font-size: 1.05rem; margin-bottom: 0.75rem;">Chicken & Rice Recovery</div>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8; margin: 0; padding-left: 1.5rem;">
                                    <li>8 oz grilled chicken breast</li>
                                    <li>1.5 cups white rice</li>
                                    <li>1 cup steamed broccoli</li>
                                    <li>1 tbsp olive oil</li>
                                </ul>
                            </div>
                            <div style="display: flex; gap: 1.5rem; padding: 0.875rem; background: var(--bg-dark); border-radius: 8px; font-size: 0.95rem; font-family: 'JetBrains Mono', monospace;">
                                <div><strong style="color: var(--accent);">P:</strong> 62g</div>
                                <div><strong style="color: var(--accent-alt);">C:</strong> 75g</div>
                                <div><strong style="color: var(--primary);">F:</strong> 18g</div>
                            </div>
                        </div>
                    </div>

                    <!-- Dinner -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">🌙</div>
                            <h2 class="card-title">Dinner</h2>
                            <div style="margin-left: auto; font-family: 'JetBrains Mono', monospace; color: var(--primary); font-weight: 700;">
                                700 cal
                            </div>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; font-size: 1.05rem; margin-bottom: 0.75rem;">Salmon with Sweet Potato</div>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8; margin: 0; padding-left: 1.5rem;">
                                    <li>6 oz grilled salmon</li>
                                    <li>1 large sweet potato</li>
                                    <li>2 cups mixed greens salad</li>
                                    <li>2 tbsp avocado oil dressing</li>
                                </ul>
                            </div>
                            <div style="display: flex; gap: 1.5rem; padding: 0.875rem; background: var(--bg-dark); border-radius: 8px; font-size: 0.95rem; font-family: 'JetBrains Mono', monospace;">
                                <div><strong style="color: var(--accent);">P:</strong> 45g</div>
                                <div><strong style="color: var(--accent-alt);">C:</strong> 55g</div>
                                <div><strong style="color: var(--primary);">F:</strong> 28g</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Daily Totals -->
                <div class="card" style="background: var(--gradient-1); border: 2px solid var(--primary);">
                    <div class="card-header">
                        <div class="card-icon">📊</div>
                        <h2 class="card-title" style="color: var(--bg-dark);">Daily Totals</h2>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1.5rem; padding: 1rem 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">CALORIES</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">2,350</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">PROTEIN</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">150g</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">CARBS</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">250g</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">FATS</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">79g</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Builder View -->
            <div class="view" id="workouts">
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <h1>Weekly Schedule Builder</h1>
                        <p class="dashboard-subtitle">Plan your workouts and generate your personalized meal plan</p>
                    </div>
                    <button class="btn" onclick="generateMealPlan()" id="generateBtn">
                        🎯 Generate Meal Plan
                    </button>
                </div>

                <div style="background: var(--gradient-accent); padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
                    <p style="margin: 0; color: var(--text-secondary);">
                        💡 <strong>How it works:</strong> Add your workouts for each day below, then click "Generate Meal Plan" to create your personalized nutrition plan optimized for your training schedule.
                    </p>
                </div>

                <!-- Weekly Schedule Builder -->
                <div id="weeklyBuilder" style="display: grid; gap: 1.5rem;">
                    <!-- Monday -->
                    <div class="card schedule-day-card">
                        <div class="card-header">
                            <h3 style="margin: 0;">📅 Monday</h3>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div class="form-group">
                                <label>Workout Type</label>
                                <select id="monday-type" class="workout-type-select">
                                    <option value="rest">Rest Day</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga/Flexibility</option>
                                    <option value="sports">Sports/Recreation</option>
                                </select>
                            </div>
                            <div class="form-group" id="monday-details" style="display: none;">
                                <label>Duration (minutes)</label>
                                <input type="number" id="monday-duration" placeholder="e.g., 60" min="15" max="180">
                            </div>
                            <div class="form-group" id="monday-intensity-group" style="display: none;">
                                <label>Intensity</label>
                                <select id="monday-intensity">
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group" id="monday-description-group" style="display: none;">
                                <label>Workout Details (optional)</label>
                                <textarea id="monday-description" rows="2" placeholder="e.g., Upper body - Bench press, Rows, Shoulder press"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Tuesday -->
                    <div class="card schedule-day-card">
                        <div class="card-header">
                            <h3 style="margin: 0;">📅 Tuesday</h3>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div class="form-group">
                                <label>Workout Type</label>
                                <select id="tuesday-type" class="workout-type-select">
                                    <option value="rest">Rest Day</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga/Flexibility</option>
                                    <option value="sports">Sports/Recreation</option>
                                </select>
                            </div>
                            <div class="form-group" id="tuesday-details" style="display: none;">
                                <label>Duration (minutes)</label>
                                <input type="number" id="tuesday-duration" placeholder="e.g., 60" min="15" max="180">
                            </div>
                            <div class="form-group" id="tuesday-intensity-group" style="display: none;">
                                <label>Intensity</label>
                                <select id="tuesday-intensity">
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group" id="tuesday-description-group" style="display: none;">
                                <label>Workout Details (optional)</label>
                                <textarea id="tuesday-description" rows="2" placeholder="e.g., 5k run at easy pace"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Wednesday -->
                    <div class="card schedule-day-card">
                        <div class="card-header">
                            <h3 style="margin: 0;">📅 Wednesday</h3>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div class="form-group">
                                <label>Workout Type</label>
                                <select id="wednesday-type" class="workout-type-select">
                                    <option value="rest">Rest Day</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga/Flexibility</option>
                                    <option value="sports">Sports/Recreation</option>
                                </select>
                            </div>
                            <div class="form-group" id="wednesday-details" style="display: none;">
                                <label>Duration (minutes)</label>
                                <input type="number" id="wednesday-duration" placeholder="e.g., 60" min="15" max="180">
                            </div>
                            <div class="form-group" id="wednesday-intensity-group" style="display: none;">
                                <label>Intensity</label>
                                <select id="wednesday-intensity">
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group" id="wednesday-description-group" style="display: none;">
                                <label>Workout Details (optional)</label>
                                <textarea id="wednesday-description" rows="2" placeholder="e.g., Lower body - Squats, Deadlifts, Lunges"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Thursday -->
                    <div class="card schedule-day-card">
                        <div class="card-header">
                            <h3 style="margin: 0;">📅 Thursday</h3>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div class="form-group">
                                <label>Workout Type</label>
                                <select id="thursday-type" class="workout-type-select">
                                    <option value="rest">Rest Day</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga/Flexibility</option>
                                    <option value="sports">Sports/Recreation</option>
                                </select>
                            </div>
                            <div class="form-group" id="thursday-details" style="display: none;">
                                <label>Duration (minutes)</label>
                                <input type="number" id="thursday-duration" placeholder="e.g., 60" min="15" max="180">
                            </div>
                            <div class="form-group" id="thursday-intensity-group" style="display: none;">
                                <label>Intensity</label>
                                <select id="thursday-intensity">
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group" id="thursday-description-group" style="display: none;">
                                <label>Workout Details (optional)</label>
                                <textarea id="thursday-description" rows="2" placeholder="e.g., HIIT circuit training"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Friday -->
                    <div class="card schedule-day-card">
                        <div class="card-header">
                            <h3 style="margin: 0;">📅 Friday</h3>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div class="form-group">
                                <label>Workout Type</label>
                                <select id="friday-type" class="workout-type-select">
                                    <option value="rest">Rest Day</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga/Flexibility</option>
                                    <option value="sports">Sports/Recreation</option>
                                </select>
                            </div>
                            <div class="form-group" id="friday-details" style="display: none;">
                                <label>Duration (minutes)</label>
                                <input type="number" id="friday-duration" placeholder="e.g., 60" min="15" max="180">
                            </div>
                            <div class="form-group" id="friday-intensity-group" style="display: none;">
                                <label>Intensity</label>
                                <select id="friday-intensity">
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group" id="friday-description-group" style="display: none;">
                                <label>Workout Details (optional)</label>
                                <textarea id="friday-description" rows="2" placeholder="e.g., Full body workout"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Saturday -->
                    <div class="card schedule-day-card">
                        <div class="card-header">
                            <h3 style="margin: 0;">📅 Saturday</h3>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div class="form-group">
                                <label>Workout Type</label>
                                <select id="saturday-type" class="workout-type-select">
                                    <option value="rest">Rest Day</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga/Flexibility</option>
                                    <option value="sports">Sports/Recreation</option>
                                </select>
                            </div>
                            <div class="form-group" id="saturday-details" style="display: none;">
                                <label>Duration (minutes)</label>
                                <input type="number" id="saturday-duration" placeholder="e.g., 60" min="15" max="180">
                            </div>
                            <div class="form-group" id="saturday-intensity-group" style="display: none;">
                                <label>Intensity</label>
                                <select id="saturday-intensity">
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group" id="saturday-description-group" style="display: none;">
                                <label>Workout Details (optional)</label>
                                <textarea id="saturday-description" rows="2" placeholder="e.g., Long bike ride"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Sunday -->
                    <div class="card schedule-day-card">
                        <div class="card-header">
                            <h3 style="margin: 0;">📅 Sunday</h3>
                        </div>
                        <div style="padding: 1rem 0;">
                            <div class="form-group">
                                <label>Workout Type</label>
                                <select id="sunday-type" class="workout-type-select">
                                    <option value="rest" selected>Rest Day</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="yoga">Yoga/Flexibility</option>
                                    <option value="sports">Sports/Recreation</option>
                                </select>
                            </div>
                            <div class="form-group" id="sunday-details" style="display: none;">
                                <label>Duration (minutes)</label>
                                <input type="number" id="sunday-duration" placeholder="e.g., 60" min="15" max="180">
                            </div>
                            <div class="form-group" id="sunday-intensity-group" style="display: none;">
                                <label>Intensity</label>
                                <select id="sunday-intensity">
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group" id="sunday-description-group" style="display: none;">
                                <label>Workout Details (optional)</label>
                                <textarea id="sunday-description" rows="2" placeholder="e.g., Active recovery - light yoga"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div class="view" id="dashboard">
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <h1>Today's Overview</h1>
                        <p class="dashboard-subtitle">Monday, February 16, 2026</p>
                    </div>
                    <button class="btn">Sync Devices</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Calories Consumed</div>
                        <div class="stat-value">1,847</div>
                        <div class="stat-change">↑ 353 remaining</div>
                        <div class="progress-indicator">
                            <div class="progress-bar" style="width: 84%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Protein</div>
                        <div class="stat-value">142g</div>
                        <div class="stat-change">↑ 23g to goal</div>
                        <div class="progress-indicator">
                            <div class="progress-bar" style="width: 86%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Calories</div>
                        <div class="stat-value">487</div>
                        <div class="stat-change">↑ 113 above target</div>
                        <div class="progress-indicator">
                            <div class="progress-bar" style="width: 130%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Steps</div>
                        <div class="stat-value">8,234</div>
                        <div class="stat-change">↑ 1,766 to goal (10k)</div>
                        <div class="progress-indicator">
                            <div class="progress-bar" style="width: 82%"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">📊</div>
                        <h2 class="card-title">Weekly Summary</h2>
                    </div>
                    <div class="stats-grid">
                        <div>
                            <div class="stat-label">Avg Daily Calories</div>
                            <div class="stat-value" style="font-size: 1.5rem;">2,156</div>
                        </div>
                        <div>
                            <div class="stat-label">Workouts Completed</div>
                            <div class="stat-value" style="font-size: 1.5rem;">4/5</div>
                        </div>
                        <div>
                            <div class="stat-label">Meal Plan Adherence</div>
                            <div class="stat-value" style="font-size: 1.5rem;">89%</div>
                        </div>
                        <div>
                            <div class="stat-label">Weight Change</div>
                            <div class="stat-value" style="font-size: 1.5rem;">-1.2lb</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Meal Plan View -->
            <div class="view" id="mealplan">
                <div class="meal-plan-container">
                    <div class="week-selector">
                        <div>
                            <h1 style="margin-bottom: 0.5rem;">Your Meal Plan</h1>
                            <p style="color: var(--text-secondary);">Week of February 16 - 22, 2026</p>
                        </div>
                        <div class="week-nav">
                            <button class="btn btn-secondary">← Previous Week</button>
                            <button class="btn btn-secondary">Next Week →</button>
                        </div>
                    </div>

                    <div class="day-tabs">
                        <button class="day-tab active" data-day="monday">Monday</button>
                        <button class="day-tab" data-day="tuesday">Tuesday</button>
                        <button class="day-tab" data-day="wednesday">Wednesday</button>
                        <button class="day-tab" data-day="thursday">Thursday</button>
                        <button class="day-tab" data-day="friday">Friday</button>
                        <button class="day-tab" data-day="saturday">Saturday</button>
                        <button class="day-tab" data-day="sunday">Sunday</button>
                    </div>

                    <div class="meals-list" id="mealsContainer">
                        <!-- Monday: Strength Training Day - Higher Protein -->
                        <!-- Breakfast -->
                        <div class="meal-card">
                            <div class="meal-time">
                                <div class="meal-time-label">Pre-Workout</div>
                                <div class="meal-time-value">5:30 AM</div>
                            </div>
                            <div class="meal-details">
                                <h3>Power Oatmeal Bowl</h3>
                                <p class="meal-ingredients">Steel-cut oats, whey protein powder, banana, peanut butter, cinnamon</p>
                                <div class="meal-macros">
                                    <div class="macro">
                                        <div class="macro-dot protein"></div>
                                        <span>35g protein</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot carbs"></div>
                                        <span>48g carbs</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot fat"></div>
                                        <span>12g fat</span>
                                    </div>
                                </div>
                            </div>
                            <div class="meal-calories">
                                <div class="calories-label">Calories</div>
                                <div class="calories-value">440</div>
                            </div>
                        </div>

                        <!-- Post-Workout -->
                        <div class="meal-card" style="border-left: 3px solid var(--accent);">
                            <div class="meal-time">
                                <div class="meal-time-label">Post-Workout</div>
                                <div class="meal-time-value">8:00 AM</div>
                            </div>
                            <div class="meal-details">
                                <h3>Recovery Protein Bowl 💪</h3>
                                <p class="meal-ingredients">Greek yogurt, granola, mixed berries, honey, chia seeds, sliced almonds, protein powder</p>
                                <div class="meal-macros">
                                    <div class="macro">
                                        <div class="macro-dot protein"></div>
                                        <span>45g protein</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot carbs"></div>
                                        <span>52g carbs</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot fat"></div>
                                        <span>14g fat</span>
                                    </div>
                                </div>
                                <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255, 107, 157, 0.1); border-radius: 8px; font-size: 0.85rem; color: var(--accent);">
                                    ⚡ Optimized for muscle recovery
                                </div>
                            </div>
                            <div class="meal-calories">
                                <div class="calories-label">Calories</div>
                                <div class="calories-value">520</div>
                            </div>
                        </div>

                        <!-- Lunch -->
                        <div class="meal-card">
                            <div class="meal-time">
                                <div class="meal-time-label">Lunch</div>
                                <div class="meal-time-value">12:30 PM</div>
                            </div>
                            <div class="meal-details">
                                <h3>Double Protein Power Bowl</h3>
                                <p class="meal-ingredients">Grilled chicken breast, steak strips, quinoa, roasted vegetables, avocado, tahini dressing</p>
                                <div class="meal-macros">
                                    <div class="macro">
                                        <div class="macro-dot protein"></div>
                                        <span>58g protein</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot carbs"></div>
                                        <span>45g carbs</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot fat"></div>
                                        <span>24g fat</span>
                                    </div>
                                </div>
                            </div>
                            <div class="meal-calories">
                                <div class="calories-label">Calories</div>
                                <div class="calories-value">620</div>
                            </div>
                        </div>

                        <!-- Afternoon Snack -->
                        <div class="meal-card">
                            <div class="meal-time">
                                <div class="meal-time-label">Snack</div>
                                <div class="meal-time-value">3:30 PM</div>
                            </div>
                            <div class="meal-details">
                                <h3>Protein-Packed Snack</h3>
                                <p class="meal-ingredients">Hard-boiled eggs, turkey jerky, mixed nuts, string cheese</p>
                                <div class="meal-macros">
                                    <div class="macro">
                                        <div class="macro-dot protein"></div>
                                        <span>32g protein</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot carbs"></div>
                                        <span>12g carbs</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot fat"></div>
                                        <span>18g fat</span>
                                    </div>
                                </div>
                            </div>
                            <div class="meal-calories">
                                <div class="calories-label">Calories</div>
                                <div class="calories-value">340</div>
                            </div>
                        </div>

                        <!-- Dinner -->
                        <div class="meal-card">
                            <div class="meal-time">
                                <div class="meal-time-label">Dinner</div>
                                <div class="meal-time-value">7:00 PM</div>
                            </div>
                            <div class="meal-details">
                                <h3>High-Protein Surf & Turf</h3>
                                <p class="meal-ingredients">Grilled salmon, lean beef, sweet potato, asparagus, Brussels sprouts</p>
                                <div class="meal-macros">
                                    <div class="macro">
                                        <div class="macro-dot protein"></div>
                                        <span>52g protein</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot carbs"></div>
                                        <span>38g carbs</span>
                                    </div>
                                    <div class="macro">
                                        <div class="macro-dot fat"></div>
                                        <span>22g fat</span>
                                    </div>
                                </div>
                            </div>
                            <div class="meal-calories">
                                <div class="calories-label">Calories</div>
                                <div class="calories-value">540</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; padding: 2rem; border-top: 1px solid var(--border);">
                        <div style="background: var(--gradient-accent); padding: 1.5rem; border-radius: 16px; margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Today's Workout</div>
                                    <div style="font-size: 1.25rem; font-weight: 700;">💪 Upper Body Hypertrophy</div>
                                </div>
                                <div class="workout-type-badge strength">STRENGTH</div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">PROTEIN TARGET</div>
                                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--accent); font-family: 'JetBrains Mono', monospace;">180g</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">1.2g per lb (muscle synthesis)</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">CARBS TARGET</div>
                                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--accent-alt); font-family: 'JetBrains Mono', monospace;">215g</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">2.6g per lb (glycogen fuel)</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">FAT TARGET</div>
                                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--primary); font-family: 'JetBrains Mono', monospace;">68g</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">0.4g per lb (hormone support)</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">CALORIES BURNED</div>
                                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--primary); font-family: 'JetBrains Mono', monospace;">600</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">75 min @ high intensity</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Science Explanation -->
                        <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1.5rem;">
                            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>🔬</span> Why These Macros for Hypertrophy Training?
                            </h3>
                            <div style="display: grid; gap: 1rem; font-size: 0.9rem; color: var(--text-secondary); line-height: 1.7;">
                                <div style="padding: 1rem; background: rgba(255, 107, 157, 0.1); border-radius: 8px; border-left: 3px solid var(--accent);">
                                    <strong style="color: var(--accent);">High Protein (40% / 180g):</strong> Strength training creates micro-tears in muscle fibers. Elevated protein intake (1.2g/lb) maximizes muscle protein synthesis (MPS) for the next 24-48 hours. Your body needs this surplus to rebuild stronger, larger muscle fibers. Post-workout meal includes 45g protein to capitalize on the "anabolic window."
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 184, 0, 0.1); border-radius: 8px; border-left: 3px solid var(--accent-alt);">
                                    <strong style="color: var(--accent-alt);">Moderate Carbs (35% / 215g):</strong> Resistance training depletes muscle glycogen stores. Adequate carbs (2.6g/lb) ensure you have energy for high-intensity sets AND replenish glycogen post-workout. Carbs also spike insulin, which is anabolic and helps shuttle amino acids into muscle cells. Pre-workout carbs provide ATP for explosive lifts.
                                </div>
                                <div style="padding: 1rem; background: rgba(127, 232, 142, 0.1); border-radius: 8px; border-left: 3px solid var(--primary);">
                                    <strong style="color: var(--primary);">Moderate Fat (25% / 68g):</strong> Fat is kept moderate to leave room for protein and carbs while maintaining testosterone production (critical for muscle growth). Fats are calorie-dense (9 cal/g vs 4 cal/g for protein/carbs), so we control portions to hit calorie targets without excess. Healthy fats support recovery and reduce inflammation.
                                </div>
                            </div>
                        </div>

                        <!-- Tomorrow's Preview -->
                        <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1.5rem;">
                            <h3 style="margin-bottom: 1rem;">🔮 Tomorrow's Nutrition (Distance Run)</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; font-family: 'JetBrains Mono', monospace;">
                                <div style="text-align: center; padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">PROTEIN</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent);">132g</div>
                                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">↓ Lower (endurance priority)</div>
                                </div>
                                <div style="text-align: center; padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">CARBS</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-alt);">370g</div>
                                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">↑ Higher (glycogen loading)</div>
                                </div>
                                <div style="text-align: center; padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">FAT</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">52g</div>
                                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">↓ Lower (carb priority)</div>
                                </div>
                                <div style="text-align: center; padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">CALORIES</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">2,530</div>
                                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">↑ +330 (endurance fuel)</div>
                                </div>
                            </div>
                            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--gradient-accent); border-radius: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                                💡 <strong style="color: var(--primary);">Why the shift?</strong> Endurance running relies primarily on glycogen and aerobic metabolism. We're carb-loading today to maximize glycogen stores for tomorrow's 60-minute run. Lower protein is sufficient as endurance training doesn't create the same muscle damage as lifting.
                            </div>
                        </div>

                        <div style="text-align: center;">
                            <div class="stat-label">Today's Total (Hypertrophy Optimized)</div>
                            <div class="stat-value" style="font-size: 2.5rem;">2,460</div>
                            <div style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                                Base: 2,200 + Workout: 600 - TEF: 340 = 2,460 net calories
                            </div>
                            <div style="margin-top: 1.5rem; display: flex; justify-content: center; gap: 2rem; font-family: 'JetBrains Mono', monospace; flex-wrap: wrap;">
                                <div>
                                    <span style="color: var(--accent); font-size: 1.25rem; font-weight: 700;">180g</span>
                                    <span style="color: var(--text-secondary);"> protein</span>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">720 cal (29%)</div>
                                </div>
                                <div>
                                    <span style="color: var(--accent-alt); font-size: 1.25rem; font-weight: 700;">215g</span>
                                    <span style="color: var(--text-secondary);"> carbs</span>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">860 cal (35%)</div>
                                </div>
                                <div>
                                    <span style="color: var(--primary); font-size: 1.25rem; font-weight: 700;">68g</span>
                                    <span style="color: var(--text-secondary);"> fat</span>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">612 cal (25%)</div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem; text-align: center;">
                            <button class="btn">Regenerate Day</button>
                            <button class="btn btn-secondary" style="margin-left: 1rem;">Swap a Meal</button>
                            <button class="btn btn-secondary" style="margin-left: 1rem;">Adjust for Fat Burning</button>
                        </div>
                    </div>
                </div>
            </div>


            <div class="view" id="profile">
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <h1>My Profile</h1>
                        <p class="dashboard-subtitle">Manage your account and preferences</p>
                    </div>
                </div>

                <div class="setup-grid">
                    <!-- Profile -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">👤</div>
                            <h2 class="card-title">Profile</h2>
                        </div>
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="userName" placeholder="Enter your name" value="Alex">
                        </div>
                        <div class="form-group">
                            <label>Age</label>
                            <input type="number" id="userAge" placeholder="Age" value="28">
                        </div>
                        <div class="form-group">
                            <label>Weight (lbs)</label>
                            <input type="number" id="userWeight" placeholder="Weight" value="165">
                        </div>
                        <div class="form-group">
                            <label>Height (inches)</label>
                            <input type="number" id="userHeight" placeholder="Height" value="68">
                        </div>
                    </div>

                    <!-- Fitness Goals -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">🎯</div>
                            <h2 class="card-title">Fitness Goals</h2>
                        </div>
                        <div class="form-group">
                            <label>Primary Goal</label>
                            <select id="fitnessGoal">
                                <option value="lose">Lose Weight</option>
                                <option value="maintain" selected>Maintain Weight</option>
                                <option value="gain">Gain Muscle</option>
                                <option value="athletic">Athletic Performance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Daily Calorie Target</label>
                            <input type="number" id="calorieTarget" placeholder="2200" value="2200">
                        </div>
                        <div class="form-group">
                            <label>Activity Level</label>
                            <select id="activityLevel">
                                <option value="sedentary">Sedentary</option>
                                <option value="light">Light Exercise (1-2 days/week)</option>
                                <option value="moderate" selected>Moderate (3-5 days/week)</option>
                                <option value="active">Very Active (6-7 days/week)</option>
                                <option value="extreme">Extremely Active (2x/day)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dietary Preferences -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">🥗</div>
                            <h2 class="card-title">Dietary Preferences</h2>
                        </div>
                        <div class="form-group">
                            <label>Diet Type</label>
                            <div class="checkbox-group">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="diet" value="vegetarian">
                                    <span>Vegetarian</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="diet" value="vegan">
                                    <span>Vegan</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="diet" value="keto">
                                    <span>Keto</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="diet" value="paleo">
                                    <span>Paleo</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="diet" value="glutenfree">
                                    <span>Gluten-Free</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Allergies & Restrictions</label>
                            <textarea id="allergies" rows="3" placeholder="e.g., nuts, dairy, shellfish, bananas, eggs"></textarea>
                        </div>
                        <button class="btn" style="width: 100%; margin-top: 1rem;" onclick="openFoodPreferencesModal()">
                            🍽️ Customize Food & Brand Preferences
                        </button>
                    </div>

                    <!-- Food Preferences -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">❤️</div>
                            <h2 class="card-title">Food Preferences</h2>
                        </div>
                        <div class="form-group">
                            <label>Favorite Foods</label>
                            <textarea id="favoriteFoods" rows="3" placeholder="e.g., chicken, salmon, avocado, sweet potato">Chicken, Salmon, Quinoa, Broccoli, Greek Yogurt</textarea>
                        </div>
                        <div class="form-group">
                            <label>Foods to Avoid</label>
                            <textarea id="avoidFoods" rows="3" placeholder="e.g., mushrooms, cilantro, mayo"></textarea>
                        </div>
                    </div>

                    <!-- Shopping Location -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">🛒</div>
                            <h2 class="card-title">Shopping Preferences</h2>
                        </div>
                        <div class="form-group">
                            <label>Primary Store</label>
                            <select id="primaryStore">
                                <option value="wholefoods" selected>Whole Foods</option>
                                <option value="trader">Trader Joe's</option>
                                <option value="kroger">Kroger</option>
                                <option value="walmart">Walmart</option>
                                <option value="target">Target</option>
                                <option value="costco">Costco</option>
                                <option value="sprouts">Sprouts</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Budget Type</label>
                            <select id="budgetType" onchange="updateBudgetLabel()">
                                <option value="weekly" selected>Weekly Budget</option>
                                <option value="daily">Daily Budget</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label id="budgetLabel">Weekly Budget ($)</label>
                            <input type="number" id="budgetAmount" placeholder="150" value="150" min="0" step="10">
                        </div>
                        <div class="form-group">
                            <label>Grocery Trips Per Week</label>
                            <select id="groceryTrips">
                                <option value="1" selected>1 trip (bulk shopping)</option>
                                <option value="2">2 trips (mid-week refresh)</option>
                                <option value="3">3 trips (frequent fresh items)</option>
                                <option value="4">4+ trips (daily fresh)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Budget Priority</label>
                            <select id="budgetPriority">
                                <option value="economy">Economy (generic brands, bulk)</option>
                                <option value="moderate" selected>Moderate (mix of brands)</option>
                                <option value="premium">Premium (organic, specialty)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Device Sync -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">⌚</div>
                            <h2 class="card-title">Device Sync</h2>
                        </div>
                        <div class="device-list">
                            <div class="device-card">
                                <div class="device-info">
                                    <div class="device-status connected"></div>
                                    <div>
                                        <div style="font-weight: 600;">Apple Watch Series 9</div>
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Last sync: 2 min ago</div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Disconnect</button>
                            </div>
                            <div class="device-card">
                                <div class="device-info">
                                    <div class="device-status"></div>
                                    <div>
                                        <div style="font-weight: 600;">Fitbit Charge 6</div>
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Not connected</div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Connect</button>
                            </div>
                            <div class="device-card">
                                <div class="device-info">
                                    <div class="device-status"></div>
                                    <div>
                                        <div style="font-weight: 600;">Garmin Forerunner</div>
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Not connected</div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Connect</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn" id="generatePlanBtn">Generate My Meal Plan</button>
                    <button class="btn btn-secondary">Save Profile</button>
                </div>
            </div>

            <!-- Shopping List View -->
            <div class="view" id="shopping">
                <div class="shopping-list-header">
                    <div>
                        <h1>Shopping List</h1>
                        <p style="color: var(--text-secondary); margin-top: 0.5rem;">Week of February 16 - 22, 2026 • Whole Foods</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary">Export to Phone</button>
                        <button class="btn">Mark All Purchased</button>
                    </div>
                </div>

                <!-- Budget Summary -->
                <div class="budget-summary">
                    <h2 style="margin-bottom: 0.5rem;">Budget Overview</h2>
                    <div class="budget-grid">
                        <div class="budget-stat">
                            <div class="budget-label">Weekly Budget</div>
                            <div class="budget-value">$150</div>
                        </div>
                        <div class="budget-stat">
                            <div class="budget-label">Estimated Total</div>
                            <div class="budget-value under">$142.50</div>
                        </div>
                        <div class="budget-stat">
                            <div class="budget-label">Remaining</div>
                            <div class="budget-value under">$7.50</div>
                        </div>
                        <div class="budget-stat">
                            <div class="budget-label">Cost Per Day</div>
                            <div class="budget-value">$20.36</div>
                        </div>
                    </div>
                    <div class="budget-progress">
                        <div class="budget-progress-bar" style="width: 95%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                        95% of budget used • 1 grocery trip planned
                    </div>
                </div>

                <div class="shopping-categories">
                    <!-- Proteins -->
                    <div class="category-section">
                        <div class="category-header">
                            <div class="category-title">
                                🥩 Proteins
                                <span class="item-count">6 items • $48.25</span>
                            </div>
                        </div>
                        <div class="items-list">
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Chicken Breast</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">2.5 lbs</div>
                                    <div class="item-price">$12.49</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Wild Salmon Fillets</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1.5 lbs</div>
                                    <div class="item-price">$18.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Greek Yogurt</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">32 oz</div>
                                    <div class="item-price">$5.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Eggs</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 dozen</div>
                                    <div class="item-price">$4.29</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Protein Powder</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 container</div>
                                    <div class="item-price">$29.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Almond Butter</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">16 oz</div>
                                    <div class="item-price">$8.99</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vegetables -->
                    <div class="category-section">
                        <div class="category-header">
                            <div class="category-title">
                                🥦 Vegetables
                                <span class="item-count">8 items • $31.75</span>
                            </div>
                        </div>
                        <div class="items-list">
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Broccoli</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">2 heads</div>
                                    <div class="item-price">$4.98</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Sweet Potatoes</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">4 medium</div>
                                    <div class="item-price">$5.96</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Bell Peppers (mixed)</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">3 peppers</div>
                                    <div class="item-price">$4.47</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Asparagus</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 bunch</div>
                                    <div class="item-price">$4.49</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Spinach</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 container</div>
                                    <div class="item-price">$3.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Avocados</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">4 avocados</div>
                                    <div class="item-price">$5.96</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Mixed Salad Greens</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 container</div>
                                    <div class="item-price">$4.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Cherry Tomatoes</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 pint</div>
                                    <div class="item-price">$3.99</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fruits -->
                    <div class="category-section">
                        <div class="category-header">
                            <div class="category-title">
                                🍎 Fruits
                                <span class="item-count">4 items • $16.45</span>
                            </div>
                        </div>
                        <div class="items-list">
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Bananas</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">6 bananas</div>
                                    <div class="item-price">$2.94</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Apples</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">5 apples</div>
                                    <div class="item-price">$4.95</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Mixed Berries</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">2 containers</div>
                                    <div class="item-price">$7.98</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Lemons</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">3 lemons</div>
                                    <div class="item-price">$1.47</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Grains & Pantry -->
                    <div class="category-section">
                        <div class="category-header">
                            <div class="category-title">
                                🌾 Grains & Pantry
                                <span class="item-count">7 items • $46.05</span>
                            </div>
                        </div>
                        <div class="items-list">
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Quinoa</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 lb</div>
                                    <div class="item-price">$6.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Granola</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 bag</div>
                                    <div class="item-price">$7.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Chia Seeds</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 bag</div>
                                    <div class="item-price">$5.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Sliced Almonds</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">8 oz</div>
                                    <div class="item-price">$5.49</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Almond Milk</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">64 oz</div>
                                    <div class="item-price">$4.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Tahini</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 jar</div>
                                    <div class="item-price">$8.99</div>
                                </div>
                            </div>
                            <div class="shopping-item">
                                <div class="item-info">
                                    <div class="item-checkbox" onclick="this.classList.toggle('checked')"></div>
                                    <div class="item-name">Honey</div>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div class="item-amount">1 jar</div>
                                    <div class="item-price">$9.99</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Workout Modal -->
    <div class="modal" id="workoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Workout</h2>
                <button class="close-modal" onclick="closeWorkoutModal()">×</button>
            </div>
            <form id="workoutForm">
                <div class="form-group">
                    <label>Workout Type</label>
                    <select id="workoutType" required>
                        <option value="strength">Strength Training (Hypertrophy)</option>
                        <option value="cardio">Cardio (Distance/Endurance)</option>
                        <option value="hiit">HIIT (High Intensity)</option>
                        <option value="yoga">Yoga/Mobility/Recovery</option>
                        <option value="rest">Rest Day</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Workout Name</label>
                    <input type="text" id="workoutName" placeholder="e.g., Upper Body Hypertrophy" required>
                </div>
                <div class="form-group">
                    <label>Day</label>
                    <select id="workoutDay" required>
                        <option value="0">Monday</option>
                        <option value="1">Tuesday</option>
                        <option value="2">Wednesday</option>
                        <option value="3">Thursday</option>
                        <option value="4">Friday</option>
                        <option value="5">Saturday</option>
                        <option value="6">Sunday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" id="workoutTime" value="06:00" required>
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="workoutDuration" placeholder="60" min="15" max="300" required>
                </div>
                <div class="form-group">
                    <label>Intensity</label>
                    <select id="workoutIntensity">
                        <option value="low">Low</option>
                        <option value="moderate">Moderate</option>
                        <option value="high" selected>High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="workoutNotes" rows="3" placeholder="Training focus, exercises, etc."></textarea>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn">Add Workout</button>
                    <button type="button" class="btn btn-secondary" onclick="closeWorkoutModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Food Preferences Modal -->
    <div class="modal" id="foodPreferencesModal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">Food & Brand Preferences</h2>
                <button class="close-modal" onclick="closeFoodPreferencesModal()">×</button>
            </div>
            
            <!-- Electrolyte Drinks & Sports Nutrition -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">⚡ Electrolyte Drinks & Powders</h3>
                <div class="checkbox-group" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="gatorade" checked>
                        <span>Gatorade</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="powerade">
                        <span>Powerade</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="bodyarmor">
                        <span>BodyArmor</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="nuun">
                        <span>Nuun Tablets</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="liquid-iv">
                        <span>Liquid I.V.</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="skratch">
                        <span>Skratch Labs</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="tailwind">
                        <span>Tailwind</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="precision">
                        <span>Precision Hydration</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="lmnt">
                        <span>LMNT</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="electrolyte" value="coconut-water">
                        <span>Coconut Water</span>
                    </label>
                </div>
            </div>

            <!-- Energy Gels & Chews -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">🔋 Energy Gels & Chews</h3>
                <div class="checkbox-group" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="gu" checked>
                        <span>GU Energy Gel</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="clif-shot">
                        <span>Clif Shot</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="maurten">
                        <span>Maurten Gel</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="huma">
                        <span>Huma Gel</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="spring-energy">
                        <span>Spring Energy</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="honey-stinger">
                        <span>Honey Stinger</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="gatorade-chews">
                        <span>Gatorade Chews</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="shot-bloks">
                        <span>Clif Shot Bloks</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="gel" value="dates">
                        <span>Dates (Natural)</span>
                    </label>
                </div>
            </div>

            <!-- Protein Sources -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">💪 Protein Sources</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="chicken" checked>
                        <span>Chicken</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="turkey">
                        <span>Turkey</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="salmon">
                        <span>Salmon</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="tuna">
                        <span>Tuna</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="eggs">
                        <span>Eggs</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="greek-yogurt">
                        <span>Greek Yogurt</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="cottage-cheese">
                        <span>Cottage Cheese</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="beef">
                        <span>Beef</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="pork">
                        <span>Pork</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="tofu">
                        <span>Tofu</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="tempeh">
                        <span>Tempeh</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="lentils">
                        <span>Lentils/Beans</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein" value="protein-powder">
                        <span>Protein Powder</span>
                    </label>
                </div>
            </div>

            <!-- Protein Powder Brands -->
            <div style="margin-bottom: 2rem; padding-left: 1.5rem; border-left: 3px solid var(--primary);">
                <h4 style="margin-bottom: 0.75rem; color: var(--text-primary); font-size: 1rem;">Protein Powder Brands</h4>
                <div class="checkbox-group" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));">
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="optimum">
                        <span>Optimum Nutrition</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="myprotein">
                        <span>MyProtein</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="orgain">
                        <span>Orgain</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="vega">
                        <span>Vega</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="garden-of-life">
                        <span>Garden of Life</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="ghost">
                        <span>Ghost</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="dymatize">
                        <span>Dymatize</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="protein-brand" value="isopure">
                        <span>Isopure</span>
                    </label>
                </div>
            </div>

            <!-- Carb Sources -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">🌾 Carbohydrate Sources</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="white-rice" checked>
                        <span>White Rice</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="brown-rice">
                        <span>Brown Rice</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="pasta">
                        <span>Pasta</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="quinoa">
                        <span>Quinoa</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="oats">
                        <span>Oats</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="sweet-potato">
                        <span>Sweet Potato</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="white-potato">
                        <span>White Potato</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="bread">
                        <span>Bread/Bagels</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="tortillas">
                        <span>Tortillas/Wraps</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="rice-cakes">
                        <span>Rice Cakes</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="granola">
                        <span>Granola</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="carbs" value="cereal">
                        <span>Cereal</span>
                    </label>
                </div>
            </div>

            <!-- Fruits -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">🍎 Fruits</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="bananas">
                        <span>Bananas</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="apples" checked>
                        <span>Apples</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="berries">
                        <span>Berries</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="oranges">
                        <span>Oranges</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="grapes">
                        <span>Grapes</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="dates">
                        <span>Dates</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="mango">
                        <span>Mango</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="pineapple">
                        <span>Pineapple</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="watermelon">
                        <span>Watermelon</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fruits" value="dried-fruit">
                        <span>Dried Fruit</span>
                    </label>
                </div>
            </div>

            <!-- Vegetables -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">🥦 Vegetables</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="broccoli" checked>
                        <span>Broccoli</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="spinach">
                        <span>Spinach</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="kale">
                        <span>Kale</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="carrots">
                        <span>Carrots</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="bell-peppers">
                        <span>Bell Peppers</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="asparagus">
                        <span>Asparagus</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="green-beans">
                        <span>Green Beans</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="brussels-sprouts">
                        <span>Brussels Sprouts</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="cauliflower">
                        <span>Cauliflower</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="zucchini">
                        <span>Zucchini</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="tomatoes">
                        <span>Tomatoes</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="mushrooms">
                        <span>Mushrooms</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vegetables" value="avocado">
                        <span>Avocado</span>
                    </label>
                </div>
            </div>

            <!-- Healthy Fats -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">🥑 Healthy Fats</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="olive-oil" checked>
                        <span>Olive Oil</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="avocado-oil">
                        <span>Avocado Oil</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="coconut-oil">
                        <span>Coconut Oil</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="nuts">
                        <span>Mixed Nuts</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="almonds">
                        <span>Almonds</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="walnuts">
                        <span>Walnuts</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="cashews">
                        <span>Cashews</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="peanut-butter">
                        <span>Peanut Butter</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="almond-butter">
                        <span>Almond Butter</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="chia-seeds">
                        <span>Chia Seeds</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="flax-seeds">
                        <span>Flax Seeds</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="fats" value="hemp-seeds">
                        <span>Hemp Seeds</span>
                    </label>
                </div>
            </div>

            <!-- Recovery & Supplements -->
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">🔬 Recovery Drinks & Supplements</h3>
                <div class="checkbox-group" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="chocolate-milk" checked>
                        <span>Chocolate Milk</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="fairlife">
                        <span>Fairlife Protein</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="muscle-milk">
                        <span>Muscle Milk</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="orgain-shake">
                        <span>Orgain Shake</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="oatmilk">
                        <span>Oat Milk</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="almond-milk">
                        <span>Almond Milk</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="creatine">
                        <span>Creatine</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="beta-alanine">
                        <span>Beta-Alanine</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="bcaa">
                        <span>BCAAs</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="recovery" value="tart-cherry">
                        <span>Tart Cherry Juice</span>
                    </label>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="saveFoodPreferences()">Save Preferences</button>
                <button class="btn btn-secondary" onclick="closeFoodPreferencesModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        console.log('🚀 Easy Fuel JavaScript starting to load...');
        
        // ========================================
        // AUTHENTICATION SYSTEM (localStorage)
        // ========================================
        
        let currentUser = null;
        let userMode = 'pro'; // 'casual' or 'pro'
        let aiLevel = 'schedule'; // 'adjust', 'schedule', or 'full' (only for pro mode)
        let dietQuality = 'performance'; // 'performance', 'budget', or 'premium'

        // Mode Selection Functions
        function selectMainMode(mode) {
            userMode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            if (mode === 'casual') {
                document.getElementById('casualModeCard').classList.add('selected');
                // For casual mode, skip AI level step
                aiLevel = null;
            } else {
                document.getElementById('proModeCard').classList.add('selected');
                // Auto-select schedule mode if nothing selected
                if (!aiLevel) {
                    aiLevel = 'schedule';
                }
            }
            
            // Store mode selection
            localStorage.setItem('easyFuelMode', mode);
            
            console.log('🎯 Mode selected:', mode);
        }

        function selectAILevel(level) {
            aiLevel = level;
            
            // Update UI
            document.querySelectorAll('.ai-level-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const levelMap = {
                'adjust': 'aiAdjustCard',
                'schedule': 'aiScheduleCard',
                'full': 'aiFullCard'
            };
            
            document.getElementById(levelMap[level]).classList.add('selected');
            
            // Store AI level
            localStorage.setItem('easyFuelAILevel', level);
            
            console.log('🤖 AI Level selected:', level);
        }

        function selectDietQuality(quality) {
            dietQuality = quality;
            
            // Update UI
            document.querySelectorAll('.diet-quality-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const qualityMap = {
                'performance': 'qualityPerformance',
                'budget': 'qualityBudget',
                'premium': 'qualityPremium'
            };
            
            document.getElementById(qualityMap[quality]).classList.add('selected');
            
            // Store diet quality
            localStorage.setItem('easyFuelDietQuality', quality);
            
            console.log('🍽️ Diet Quality selected:', quality);
        }

        // Save mode, AI level, and diet quality to user data
        function saveUserMode() {
            if (currentUser) {
                if (!currentUser.data) currentUser.data = {};
                currentUser.data.mode = userMode;
                currentUser.data.aiLevel = aiLevel;
                currentUser.data.dietQuality = dietQuality;
                saveUserData();
                console.log('💾 Saved mode:', userMode, 'AI level:', aiLevel, 'Diet quality:', dietQuality);
            }
        }

        // Load mode, AI level, and diet quality from user data
        function loadUserMode() {
            if (currentUser && currentUser.data) {
                if (currentUser.data.mode) {
                    userMode = currentUser.data.mode;
                    selectMainMode(userMode);
                }
                if (currentUser.data.aiLevel) {
                    aiLevel = currentUser.data.aiLevel;
                    if (userMode === 'pro') {
                        selectAILevel(aiLevel);
                    }
                }
                if (currentUser.data.dietQuality) {
                    dietQuality = currentUser.data.dietQuality;
                    selectDietQuality(dietQuality);
                }
                console.log('📂 Loaded mode:', userMode, 'AI level:', aiLevel, 'Diet quality:', dietQuality);
            } else {
                // Set defaults
                selectMainMode('pro');
                selectAILevel('schedule');
                selectDietQuality('performance');
            }
        }

        // Check if user is logged in on page load
        function checkAuth() {
            console.log('🔍 checkAuth() called');
            const userJSON = localStorage.getItem('easyFuelCurrentUser');
            console.log('📦 localStorage data:', userJSON ? 'Found user data' : 'No user data');
            
            if (userJSON) {
                try {
                    currentUser = JSON.parse(userJSON);
                    console.log('✅ User loaded:', currentUser.name, currentUser.email);
                    
                    // Update last login time
                    currentUser.lastLogin = new Date().toISOString();
                    localStorage.setItem('easyFuelCurrentUser', JSON.stringify(currentUser));
                    
                    // Hide auth screen
                    const authOverlay = document.getElementById('authOverlay');
                    if (authOverlay) {
                        authOverlay.classList.remove('active');
                        console.log('🔓 Auth overlay hidden');
                    }
                    
                    updateUIForLoggedInUser();
                    loadUserData();
                    loadUserMode(); // Load saved mode preferences
                    
                    // Skip onboarding if user has already completed it
                    const hasCompletedOnboarding = currentUser.data && currentUser.data.onboardingComplete;
                    if (hasCompletedOnboarding) {
                        const onboardingOverlay = document.getElementById('onboardingOverlay');
                        if (onboardingOverlay) {
                            onboardingOverlay.classList.remove('active');
                            console.log('✅ Onboarding skipped (already completed)');
                        }
                    }
                    
                    // Show welcome back message if it's been more than an hour
                    const lastLogin = currentUser.lastLogin ? new Date(currentUser.lastLogin) : null;
                    const now = new Date();
                    if (lastLogin && (now - lastLogin) > 3600000) { // More than 1 hour
                        setTimeout(() => {
                            const greeting = getTimeBasedGreeting();
                            showNotification(`${greeting}, ${currentUser.name}! 👋`, 'Welcome back to Easy Fuel');
                        }, 1000);
                    }
                    
                    console.log('✅ Login successful - user should stay logged in');
                } catch (error) {
                    // If there's an error parsing user data, clear it and show login
                    console.error('❌ Error loading user data:', error);
                    localStorage.removeItem('easyFuelCurrentUser');
                    const authOverlay = document.getElementById('authOverlay');
                    const onboardingOverlay = document.getElementById('onboardingOverlay');
                    if (authOverlay) authOverlay.classList.add('active');
                    if (onboardingOverlay) onboardingOverlay.classList.remove('active');
                }
            } else {
                // No user logged in - show auth screen
                console.log('❌ No user logged in - showing auth screen');
                const authOverlay = document.getElementById('authOverlay');
                const onboardingOverlay = document.getElementById('onboardingOverlay');
                if (authOverlay) authOverlay.classList.add('active');
                // Hide onboarding until after login/signup
                if (onboardingOverlay) onboardingOverlay.classList.remove('active');
            }
        }

        // Switch between login/signup tabs
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            
            // Clear error messages
            document.getElementById('loginError').classList.remove('show');
            document.getElementById('signupError').classList.remove('show');
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
        }

        // Handle Login
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            console.log('🔐 Login attempt:', email);
            
            // Get users from localStorage
            const usersJSON = localStorage.getItem('easyFuelUsers');
            const users = usersJSON ? JSON.parse(usersJSON) : [];
            console.log('📋 Total users in database:', users.length);
            
            // Find user
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                console.log('✅ User found:', user.name);
                currentUser = user;
                
                // CRITICAL: Save to localStorage
                localStorage.setItem('easyFuelCurrentUser', JSON.stringify(user));
                console.log('💾 Saved to localStorage');
                
                // Verify it was saved
                const verify = localStorage.getItem('easyFuelCurrentUser');
                console.log('🔍 Verification - data saved:', verify ? 'YES' : 'NO');
                
                document.getElementById('authOverlay').classList.remove('active');
                updateUIForLoggedInUser();
                loadUserData();
                
                // Show success message briefly
                console.log('🎉 Login complete - you should stay logged in now!');
            } else {
                console.log('❌ Login failed - invalid credentials');
                const errorEl = document.getElementById('loginError');
                errorEl.textContent = '❌ Invalid email or password';
                errorEl.classList.add('show');
            }
        }

        // Handle Signup
        function handleSignup(event) {
            event.preventDefault();
            console.log('📝 Signup attempt started...');
            
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            
            console.log('📧 Signup data:', { name, email, passwordLength: password.length });
            
            const errorEl = document.getElementById('signupError');
            
            // Validate passwords match
            if (password !== passwordConfirm) {
                console.log('❌ Passwords do not match');
                errorEl.textContent = '❌ Passwords do not match';
                errorEl.classList.add('show');
                return;
            }
            
            // Validate password length
            if (password.length < 6) {
                console.log('❌ Password too short');
                errorEl.textContent = '❌ Password must be at least 6 characters';
                errorEl.classList.add('show');
                return;
            }
            
            // Get existing users
            const usersJSON = localStorage.getItem('easyFuelUsers');
            const users = usersJSON ? JSON.parse(usersJSON) : [];
            console.log('📋 Existing users:', users.length);
            
            // Check if email already exists
            if (users.find(u => u.email === email)) {
                console.log('❌ Email already exists');
                errorEl.textContent = '❌ Email already registered. Please login instead.';
                errorEl.classList.add('show');
                return;
            }
            
            // Create new user
            const newUser = {
                id: Date.now().toString(),
                name,
                email,
                password, // Note: In production, use proper password hashing!
                createdAt: new Date().toISOString(),
                data: {
                    onboardingComplete: false,
                    weight: 165,
                    height: 68,
                    age: 28
                }
            };
            
            console.log('✅ Creating new user:', newUser.name);
            
            users.push(newUser);
            localStorage.setItem('easyFuelUsers', JSON.stringify(users));
            
            // Log them in
            currentUser = newUser;
            localStorage.setItem('easyFuelCurrentUser', JSON.stringify(newUser));
            
            console.log('🔓 Hiding auth overlay...');
            const authOverlay = document.getElementById('authOverlay');
            if (authOverlay) {
                authOverlay.remove(); // Completely remove it
            }
            
            updateUIForLoggedInUser();
            
            // Show onboarding for new users
            console.log('📋 Showing onboarding...');
            const onboardingOverlay = document.getElementById('onboardingOverlay');
            if (onboardingOverlay) {
                onboardingOverlay.classList.add('active');
                onboardingOverlay.style.display = 'flex';
            }
            
            console.log('🎉 Signup complete!');
        }

        // Update UI for logged in user
        function updateUIForLoggedInUser() {
            const headerContent = document.querySelector('.header-content');
            
            // Remove existing user menu if present
            const existingMenu = document.getElementById('userMenu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            // Format last login time
            let lastLoginText = '';
            if (currentUser.lastLogin) {
                const lastLogin = new Date(currentUser.lastLogin);
                const now = new Date();
                const diffMs = now - lastLogin;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) {
                    lastLoginText = 'Just now';
                } else if (diffMins < 60) {
                    lastLoginText = diffMins + ' min ago';
                } else if (diffMins < 1440) {
                    const hours = Math.floor(diffMins / 60);
                    lastLoginText = hours + ' hour' + (hours > 1 ? 's' : '') + ' ago';
                } else {
                    lastLoginText = lastLogin.toLocaleDateString();
                }
            }
            
            // Add user avatar to header
            const userMenu = document.createElement('div');
            userMenu.id = 'userMenu';
            userMenu.className = 'user-menu';
            userMenu.innerHTML = `
                <div class="user-avatar" onclick="toggleUserMenu()">
                    ${currentUser.name.charAt(0).toUpperCase()}
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-dropdown-header">
                        <div class="user-dropdown-name">${currentUser.name}</div>
                        <div class="user-dropdown-email">${currentUser.email}</div>
                        ${lastLoginText ? `<div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">Last login: ${lastLoginText}</div>` : ''}
                    </div>
                    <button class="user-dropdown-item" onclick="saveUserData(); alert('✅ Progress saved!')">
                        <span>💾</span> Save Progress
                    </button>
                    <button class="user-dropdown-item danger" onclick="logout()">
                        <span>🚪</span> Logout
                    </button>
                </div>
            `;
            headerContent.appendChild(userMenu);
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const userMenu = document.getElementById('userMenu');
                const dropdown = document.getElementById('userDropdown');
                if (userMenu && !userMenu.contains(event.target) && dropdown) {
                    dropdown.classList.remove('active');
                }
            });
        }

        // Toggle user menu dropdown
        function toggleUserMenu(event) {
            if (event) event.stopPropagation();
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) {
                dropdown.classList.toggle('active');
            }
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout? Make sure your progress is saved!')) {
                // Save before logout
                saveUserData();
                
                currentUser = null;
                localStorage.removeItem('easyFuelCurrentUser');
                document.getElementById('authOverlay').classList.add('active');
                
                const userMenu = document.getElementById('userMenu');
                if (userMenu) {
                    userMenu.remove();
                }
                
                // Reset app state
                document.querySelector('[data-view="setup"]').click();
            }
        }

        // Save user data to localStorage
        function saveUserData() {
            if (!currentUser) return;
            
            const usersJSON = localStorage.getItem('easyFuelUsers');
            const users = JSON.parse(usersJSON || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                // Collect all user data
                currentUser.data = {
                    profile: {
                        name: document.getElementById('userName')?.value,
                        age: document.getElementById('userAge')?.value,
                        weight: document.getElementById('userWeight')?.value,
                        height: document.getElementById('userHeight')?.value,
                        goal: document.getElementById('fitnessGoal')?.value,
                        calories: document.getElementById('calorieTarget')?.value,
                        activity: document.getElementById('activityLevel')?.value,
                    },
                    workouts: weeklyWorkouts,
                    preferences: foodPreferences,
                    shopping: {
                        store: document.getElementById('primaryStore')?.value,
                        budgetType: document.getElementById('budgetType')?.value,
                        budget: document.getElementById('budgetAmount')?.value,
                        trips: document.getElementById('groceryTrips')?.value,
                        priority: document.getElementById('budgetPriority')?.value,
                    },
                    allergies: document.getElementById('allergies')?.value,
                    onboardingComplete: localStorage.getItem('easyFuelOnboardingComplete') === 'true',
                    lastSaved: new Date().toISOString()
                };
                
                users[userIndex] = currentUser;
                localStorage.setItem('easyFuelUsers', JSON.stringify(users));
                localStorage.setItem('easyFuelCurrentUser', JSON.stringify(currentUser));
                
                console.log('✅ Progress saved at ' + new Date().toLocaleTimeString());
            }
        }

        // Load user data from localStorage
        function loadUserData() {
            if (!currentUser || !currentUser.data) return;
            
            const data = currentUser.data;
            
            // Load profile
            if (data.profile) {
                if (data.profile.name) document.getElementById('userName').value = data.profile.name;
                if (data.profile.age) document.getElementById('userAge').value = data.profile.age;
                if (data.profile.weight) document.getElementById('userWeight').value = data.profile.weight;
                if (data.profile.height) document.getElementById('userHeight').value = data.profile.height;
                if (data.profile.goal) document.getElementById('fitnessGoal').value = data.profile.goal;
                if (data.profile.calories) document.getElementById('calorieTarget').value = data.profile.calories;
                if (data.profile.activity) document.getElementById('activityLevel').value = data.profile.activity;
            }
            
            // Load workouts
            if (data.workouts) {
                weeklyWorkouts = data.workouts;
                if (typeof initWorkoutCalendar === 'function') {
                    initWorkoutCalendar();
                }
            }
            
            // Load preferences
            if (data.preferences) {
                foodPreferences = data.preferences;
            }
            
            // Load shopping
            if (data.shopping) {
                if (data.shopping.store) document.getElementById('primaryStore').value = data.shopping.store;
                if (data.shopping.budgetType) document.getElementById('budgetType').value = data.shopping.budgetType;
                if (data.shopping.budget) document.getElementById('budgetAmount').value = data.shopping.budget;
                if (data.shopping.trips) document.getElementById('groceryTrips').value = data.shopping.trips;
                if (data.shopping.priority) document.getElementById('budgetPriority').value = data.shopping.priority;
            }
            
            // Load allergies
            if (data.allergies) {
                document.getElementById('allergies').value = data.allergies;
            }
            
            console.log('✅ User data loaded for ' + currentUser.name);
        }

        // Auto-save every 60 seconds
        setInterval(() => {
            if (currentUser) {
                saveUserData();
            }
        }, 60000);

        // Save before page unload
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                saveUserData();
            }
        });


        // Tab Switching for Bottom Navigation
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            const target = document.getElementById(tabName);
            if (target) target.classList.add('active');
            document.querySelectorAll('.bottom-nav-btn').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector('[data-tab="' + tabName + '"]');
            if (btn) btn.classList.add('active');
        }


        // Update today's date on home tab
        function updateTodayDate() {
            const dateEl = document.getElementById('todayDateDisplay');
            if (dateEl) {
                const today = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                dateEl.textContent = today.toLocaleDateString('en-US', options);
            }
        }

        // Call on page load
        updateTodayDate();

        // Check auth on page load - THIS MUST RUN FIRST
        checkAuth();
        
        // Update debug panel
        function updateDebugPanel() {
            const usersJSON = localStorage.getItem('easyFuelUsers');
            const users = usersJSON ? JSON.parse(usersJSON) : [];
            const currentUserJSON = localStorage.getItem('easyFuelCurrentUser');
            
            const userCountEl = document.getElementById('debugUserCount');
            const currentUserEl = document.getElementById('debugCurrentUser');
            const localStorageEl = document.getElementById('debugLocalStorage');
            
            if (userCountEl) userCountEl.textContent = users.length;
            if (currentUserEl) {
                if (currentUserJSON) {
                    const user = JSON.parse(currentUserJSON);
                    currentUserEl.textContent = user.name + ' (' + user.email + ')';
                    currentUserEl.style.color = 'var(--primary)';
                } else {
                    currentUserEl.textContent = 'None (Not logged in)';
                    currentUserEl.style.color = 'var(--accent)';
                }
            }
            
            // Test localStorage
            try {
                localStorage.setItem('test', 'works');
                const test = localStorage.getItem('test');
                localStorage.removeItem('test');
                if (localStorageEl) {
                    localStorageEl.textContent = test === 'works' ? '✅ YES' : '❌ NO';
                    localStorageEl.style.color = test === 'works' ? 'var(--primary)' : 'var(--accent)';
                }
            } catch (e) {
                if (localStorageEl) {
                    localStorageEl.textContent = '❌ BLOCKED';
                    localStorageEl.style.color = 'var(--accent)';
                }
            }
        }
        
        // Test localStorage function
        function testLocalStorage() {
            updateDebugPanel();
            
            // Show all localStorage keys
            console.log('🔍 All localStorage keys:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                console.log(`  ${key}:`, localStorage.getItem(key).substring(0, 100) + '...');
            }
            
            alert('Check the browser console (F12) for detailed localStorage info');
        }
        
        // Update debug panel when page loads
        setTimeout(updateDebugPanel, 500);
        
        // Also update after login
        const originalHandleLogin = handleLogin;
        handleLogin = function(event) {
            originalHandleLogin(event);
            setTimeout(updateDebugPanel, 500);
        };

        // Helper function for time-based greetings
        function getTimeBasedGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Good morning';
            if (hour < 18) return 'Good afternoon';
            return 'Good evening';
        }

        // Show notification helper
        function showNotification(title, message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: var(--bg-card);
                border: 1px solid var(--primary);
                border-radius: 12px;
                padding: 1rem 1.5rem;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                animation: slideInRight 0.5s ease;
                max-width: 300px;
            `;
            notification.innerHTML = `
                <div style="font-weight: 700; margin-bottom: 0.25rem; color: var(--text-primary);">${title}</div>
                <div style="font-size: 0.9rem; color: var(--text-secondary);">${message}</div>
            `;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(400px);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.5s ease reverse';
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }

        // ========================================
        // REST OF THE APP CODE
        // ========================================
        
        // Workout schedule data structure
        let weeklyWorkouts = {
            0: [], // Monday
            1: [], // Tuesday
            2: [], // Wednesday
            3: [], // Thursday
            4: [], // Friday
            5: [], // Saturday
            6: []  // Sunday
        };

        // Calorie burn rates per minute for different workout types and intensities
        const calorieRates = {
            strength: { low: 4, moderate: 6, high: 8 },
            cardio: { low: 8, moderate: 11, high: 14 },
            hiit: { low: 10, moderate: 13, high: 16 },
            yoga: { low: 2, moderate: 3, high: 4 },
            rest: { low: 0, moderate: 0, high: 0 },
            custom: { low: 5, moderate: 7, high: 10 }
        };

        // Calculate estimated calories burned
        function calculateCaloriesBurned(workoutType, duration, intensity) {
            const rate = calorieRates[workoutType][intensity];
            return Math.round(rate * duration);
        }

        // Macro ratios for different workout types
        const macroStrategies = {
            strength: { protein: 40, carbs: 35, fat: 25, calorieModifier: 1.1, name: "High Protein", icon: "💪" },
            cardio: { protein: 20, carbs: 60, fat: 20, calorieModifier: 1.15, name: "High Carb", icon: "🏃" },
            hiit: { protein: 30, carbs: 45, fat: 25, calorieModifier: 1.2, name: "Balanced", icon: "⚡" },
            yoga: { protein: 25, carbs: 45, fat: 30, calorieModifier: 0.95, name: "Recovery", icon: "🧘" },
            rest: { protein: 30, carbs: 40, fat: 30, calorieModifier: 0.85, name: "Rest Day", icon: "😴" },
            custom: { protein: 30, carbs: 40, fat: 30, calorieModifier: 1.0, name: "Custom", icon: "✏️" }
        };

        // Initialize workout calendar
        function initWorkoutCalendar() {
            const calendar = document.getElementById('workoutCalendar');
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const dates = ['Feb 16', 'Feb 17', 'Feb 18', 'Feb 19', 'Feb 20', 'Feb 21', 'Feb 22'];
            
            calendar.innerHTML = '';
            days.forEach((day, index) => {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';
                dayColumn.innerHTML = `
                    <div class="day-header">
                        <div class="day-name">${day}</div>
                        <div class="day-date">${dates[index]}</div>
                    </div>
                    <div class="workouts-container" id="day-${index}">
                        <button class="add-workout-btn" onclick="openWorkoutModal('', ${index})">+ Add Workout</button>
                    </div>
                `;
                calendar.appendChild(dayColumn);
            });

            // Add sample workouts
            addSampleWorkouts();
        }

        // Add sample workouts for demonstration
        function addSampleWorkouts() {
            const sampleWorkouts = [
                { day: 0, type: 'strength', name: 'Upper Body Hypertrophy', time: '06:00', duration: 75, intensity: 'high' },
                { day: 1, type: 'cardio', name: 'Distance Run - 10K', time: '06:30', duration: 60, intensity: 'moderate' },
                { day: 2, type: 'hiit', name: 'Circuit Training', time: '17:00', duration: 45, intensity: 'high' },
                { day: 3, type: 'yoga', name: 'Mobility & Stretching', time: '07:00', duration: 45, intensity: 'low' },
                { day: 4, type: 'strength', name: 'Lower Body Hypertrophy', time: '06:00', duration: 75, intensity: 'high' },
                { day: 5, type: 'cardio', name: 'Long Run - 15K', time: '07:00', duration: 90, intensity: 'moderate' },
                { day: 6, type: 'rest', name: 'Rest & Recovery', time: '', duration: 0, intensity: 'low' }
            ];

            sampleWorkouts.forEach(workout => {
                // Calculate estimated calories burned
                workout.caloriesBurned = calculateCaloriesBurned(workout.type, workout.duration, workout.intensity);
                weeklyWorkouts[workout.day].push(workout);
                renderWorkout(workout.day, workout);
            });

            updateNutritionStrategy();
        }

        // Render a workout in the calendar
        function renderWorkout(dayIndex, workout) {
            const container = document.getElementById(`day-${dayIndex}`);
            const addButton = container.querySelector('.add-workout-btn');
            
            const workoutSlot = document.createElement('div');
            workoutSlot.className = 'workout-slot';
            workoutSlot.innerHTML = `
                <div class="workout-type-badge ${workout.type}">${workout.type.toUpperCase()}</div>
                <div class="workout-name">${workout.name}</div>
                <div class="workout-details">
                    ${workout.time ? `<div class="workout-time">🕐 ${formatTime(workout.time)}</div>` : ''}
                    ${workout.duration ? `<div>⏱️ ${workout.duration} min</div>` : ''}
                    <div>💪 ${workout.intensity} intensity</div>
                    ${workout.caloriesBurned ? `<div style="color: var(--primary); font-weight: 600; margin-top: 0.25rem;">🔥 ~${workout.caloriesBurned} cal burned</div>` : ''}
                </div>
            `;
            
            container.insertBefore(workoutSlot, addButton);
        }

        // Format time for display
        function formatTime(time) {
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
            return `${displayHour}:${minutes} ${ampm}`;
        }

        // Update nutrition strategy panel
        function updateNutritionStrategy() {
            const strategyGrid = document.getElementById('strategyGrid');
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            strategyGrid.innerHTML = '';
            
            Object.keys(weeklyWorkouts).forEach((dayIndex) => {
                const workouts = weeklyWorkouts[dayIndex];
                const primaryWorkout = workouts[0]; // Get primary workout for the day
                
                if (primaryWorkout) {
                    const strategy = macroStrategies[primaryWorkout.type];
                    const baseCalories = 2200;
                    const adjustedCalories = Math.round(baseCalories * strategy.calorieModifier);
                    
                    const card = document.createElement('div');
                    card.className = 'strategy-card';
                    card.innerHTML = `
                        <div class="strategy-day">${days[dayIndex]} ${strategy.icon}</div>
                        <div class="strategy-focus">${strategy.name}</div>
                        <div class="strategy-macros">
                            <div style="color: var(--accent);">P: ${strategy.protein}%</div>
                            <div style="color: var(--accent-alt);">C: ${strategy.carbs}%</div>
                            <div style="color: var(--primary);">F: ${strategy.fat}%</div>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-secondary);">
                            ~${adjustedCalories} cal
                        </div>
                    `;
                    strategyGrid.appendChild(card);
                }
            });
        }

        // Modal functions
        let currentEditDay = null;

        function openWorkoutModal(type = '', day = null) {
            const modal = document.getElementById('workoutModal');
            modal.classList.add('active');
            currentEditDay = day;
            
            if (type) {
                document.getElementById('workoutType').value = type;
                updateWorkoutNameSuggestion(type);
            }
            
            if (day !== null) {
                document.getElementById('workoutDay').value = day;
            }
        }

        function closeWorkoutModal() {
            const modal = document.getElementById('workoutModal');
            modal.classList.remove('active');
            document.getElementById('workoutForm').reset();
            currentEditDay = null;
        }

        function updateWorkoutNameSuggestion(type) {
            const suggestions = {
                strength: 'Hypertrophy Training',
                cardio: 'Distance Run',
                hiit: 'HIIT Circuit',
                yoga: 'Yoga & Mobility',
                rest: 'Rest Day',
                custom: 'Custom Workout'
            };
            
            const nameInput = document.getElementById('workoutName');
            if (!nameInput.value) {
                nameInput.value = suggestions[type] || '';
            }
        }

        // Handle workout form submission
        document.getElementById('workoutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const workout = {
                type: document.getElementById('workoutType').value,
                name: document.getElementById('workoutName').value,
                day: parseInt(document.getElementById('workoutDay').value),
                time: document.getElementById('workoutTime').value,
                duration: parseInt(document.getElementById('workoutDuration').value),
                intensity: document.getElementById('workoutIntensity').value,
                notes: document.getElementById('workoutNotes').value
            };
            
            // Calculate estimated calories burned
            workout.caloriesBurned = calculateCaloriesBurned(workout.type, workout.duration, workout.intensity);
            
            weeklyWorkouts[workout.day].push(workout);
            renderWorkout(workout.day, workout);
            updateNutritionStrategy();
            closeWorkoutModal();
        });

        // Listen for workout type changes to update name suggestion
        document.getElementById('workoutType').addEventListener('change', function(e) {
            updateWorkoutNameSuggestion(e.target.value);
        });

        // Generate meal plan based on workouts
        function generateMealPlanFromWorkouts() {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Analyzing Workouts...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.textContent = '✓ Meal Plan Generated!';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    document.querySelector('[data-view="mealplan"]').click();
                }, 1000);
            }, 2000);
        }

        // Tab Navigation
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active tab button
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Show corresponding view
                const viewId = btn.getAttribute('data-view');
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById(viewId).classList.add('active');
            });
        });

        // Day tabs in meal plan
        document.querySelectorAll('.day-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                // In a real app, this would load different day's meals
            });
        });

        // Generate meal plan button
        document.getElementById('generatePlanBtn').addEventListener('click', () => {
            // Show loading state
            const btn = document.getElementById('generatePlanBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Generating...';
            btn.disabled = true;
            
            // Simulate AI generation
            setTimeout(() => {
                btn.textContent = '✓ Plan Generated!';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    
                    // Switch to workout view first
                    document.querySelector('[data-view="workouts"]').click();
                }, 1000);
            }, 2000);
        });

        // Add some interactivity to device sync
        document.querySelectorAll('.device-card button').forEach(btn => {
            btn.addEventListener('click', function() {
                const status = this.closest('.device-card').querySelector('.device-status');
                const isConnected = status.classList.contains('connected');
                
                if (isConnected) {
                    status.classList.remove('connected');
                    this.textContent = 'Connect';
                    this.closest('.device-card').querySelector('.device-info div:last-child div:last-child').textContent = 'Not connected';
                } else {
                    status.classList.add('connected');
                    this.textContent = 'Disconnect';
                    this.closest('.device-card').querySelector('.device-info div:last-child div:last-child').textContent = 'Last sync: just now';
                }
            });
        });

        // Initialize workout calendar on page load
        document.addEventListener('DOMContentLoaded', () => {
            initWorkoutCalendar();
        });

        // Close modal when clicking outside
        document.getElementById('workoutModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeWorkoutModal();
            }
        });

        // Update budget label based on budget type selection
        function updateBudgetLabel() {
            const budgetType = document.getElementById('budgetType').value;
            const label = document.getElementById('budgetLabel');
            label.textContent = budgetType === 'weekly' ? 'Weekly Budget ($)' : 'Daily Budget ($)';
        }

        // Food preferences modal functions
        let foodPreferences = {
            electrolytes: ['gatorade'],
            gels: ['gu', 'dates'],
            proteins: ['chicken', 'greek-yogurt'],
            proteinBrands: [],
            carbs: ['white-rice'],
            fruits: ['apples'],
            vegetables: ['broccoli'],
            fats: ['olive-oil'],
            recovery: ['chocolate-milk']
        };

        function openFoodPreferencesModal() {
            document.getElementById('foodPreferencesModal').classList.add('active');
        }

        function closeFoodPreferencesModal() {
            document.getElementById('foodPreferencesModal').classList.remove('active');
        }

        function saveFoodPreferences() {
            // Collect all selected preferences
            foodPreferences.electrolytes = Array.from(document.querySelectorAll('input[name="electrolyte"]:checked')).map(el => el.value);
            foodPreferences.gels = Array.from(document.querySelectorAll('input[name="gel"]:checked')).map(el => el.value);
            foodPreferences.proteins = Array.from(document.querySelectorAll('input[name="protein"]:checked')).map(el => el.value);
            foodPreferences.proteinBrands = Array.from(document.querySelectorAll('input[name="protein-brand"]:checked')).map(el => el.value);
            foodPreferences.carbs = Array.from(document.querySelectorAll('input[name="carbs"]:checked')).map(el => el.value);
            foodPreferences.fruits = Array.from(document.querySelectorAll('input[name="fruits"]:checked')).map(el => el.value);
            foodPreferences.vegetables = Array.from(document.querySelectorAll('input[name="vegetables"]:checked')).map(el => el.value);
            foodPreferences.fats = Array.from(document.querySelectorAll('input[name="fats"]:checked')).map(el => el.value);
            foodPreferences.recovery = Array.from(document.querySelectorAll('input[name="recovery"]:checked')).map(el => el.value);

            // Show confirmation
            alert('Food preferences saved! Your meal plans will now use only your selected foods and brands.');
            
            closeFoodPreferencesModal();
        }

        // Close modals when clicking outside
        document.getElementById('foodPreferencesModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFoodPreferencesModal();
            }
        });

        // Onboarding flow
        let currentOnboardingStep = 0;
        const totalOnboardingSteps = 8; // 0: Mode, 1: Profile, 2: AI Level, 3: Diet Quality, 4: Food Exclusions, 5: Restrictions, 6: Shopping, 7: Devices

        function updateOnboardingProgress() {
            // Update progress dots
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index <= currentOnboardingStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });

            // Update step visibility
            document.querySelectorAll('.onboarding-step').forEach((step, index) => {
                if (index === currentOnboardingStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });

            // Update button visibility
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');

            prevBtn.style.display = currentOnboardingStep > 0 ? 'block' : 'none';
            
            if (currentOnboardingStep === totalOnboardingSteps - 1) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                finishBtn.style.display = 'none';
            }
        }

        function nextStep() {
            // Step 0: Mode selection - ensure a mode is chosen
            if (currentOnboardingStep === 0) {
                if (!userMode) {
                    alert('Please select a mode to continue');
                    return;
                }
                console.log('✅ Proceeding with mode:', userMode);
            }
            
            // Step 1: Profile - validate required fields
            if (currentOnboardingStep === 1) {
                const name = document.getElementById('onboarding-name')?.value;
                const age = document.getElementById('onboarding-age')?.value;
                const weight = document.getElementById('onboarding-weight')?.value;
                const height = document.getElementById('onboarding-height')?.value;
                
                if (!name || !age || !weight || !height) {
                    alert('Please fill in all fields before continuing');
                    return;
                }
            }
            
            // Step 2: AI Level (only for Pro users) - ensure selection
            if (currentOnboardingStep === 2 && userMode === 'pro') {
                if (!aiLevel) {
                    alert('Please select an AI level to continue');
                    return;
                }
                console.log('✅ Proceeding with AI level:', aiLevel);
            }
            
            // If casual mode on step 2, skip to step 4 (diet quality)
            if (currentOnboardingStep === 2 && userMode === 'casual') {
                aiLevel = null; // Clear AI level for casual users
                currentOnboardingStep = 3; // Will be incremented to 4
            }
            
            // Step 3: Diet Quality - ensure selection
            if (currentOnboardingStep === 3) {
                if (!dietQuality) {
                    alert('Please select a diet quality preference to continue');
                    return;
                }
                console.log('✅ Proceeding with diet quality:', dietQuality);
            }
            
            if (currentOnboardingStep < totalOnboardingSteps - 1) {
                currentOnboardingStep++;
                updateOnboardingProgress();
            }
        }

        function previousStep() {
            if (currentOnboardingStep > 0) {
                // If on step 4 (diet quality) and in casual mode, skip back over AI level (step 3)
                if (currentOnboardingStep === 4 && userMode === 'casual') {
                    currentOnboardingStep = 2; // Go back to mode selection
                } else {
                    currentOnboardingStep--;
                }
                updateOnboardingProgress();
            }
        }

        function skipOnboarding() {
            if (confirm('Are you sure you want to skip setup? You can always complete this later in Settings, but your meal plans will be less personalized.')) {
                closeOnboarding();
            }
        }

        function finishOnboarding() {
            // Collect all onboarding data
            const onboardingData = {
                profile: {
                    name: document.getElementById('onboarding-name')?.value,
                    age: document.getElementById('onboarding-age')?.value,
                    weight: document.getElementById('onboarding-weight')?.value,
                    height: document.getElementById('onboarding-height')?.value,
                    goal: document.getElementById('onboarding-goal')?.value,
                    calories: document.getElementById('onboarding-calories')?.value,
                    activity: document.getElementById('onboarding-activity')?.value
                },
                foodPreferences: {
                    electrolytes: Array.from(document.querySelectorAll('.onboard-electrolyte:checked')).map(el => el.value),
                    proteins: Array.from(document.querySelectorAll('.onboard-protein:checked')).map(el => el.value),
                    carbs: Array.from(document.querySelectorAll('.onboard-carbs:checked')).map(el => el.value)
                },
                restrictions: {
                    allergies: document.getElementById('onboarding-allergies')?.value,
                    dislikes: document.getElementById('onboarding-dislikes')?.value,
                    diets: Array.from(document.querySelectorAll('.onboard-diet:checked')).map(el => el.value)
                },
                shopping: {
                    store: document.getElementById('onboarding-store')?.value,
                    budgetType: document.getElementById('onboarding-budget-type')?.value,
                    budget: document.getElementById('onboarding-budget')?.value,
                    trips: document.getElementById('onboarding-trips')?.value,
                    priority: document.getElementById('onboarding-priority')?.value
                }
            };

            // Save to localStorage (legacy)
            localStorage.setItem('easyFuelOnboardingComplete', 'true');
            localStorage.setItem('easyFuelUserData', JSON.stringify(onboardingData));

            // Populate the main form with onboarding data
            populateMainFormFromOnboarding(onboardingData);

            // If user is logged in, save to their account
            if (currentUser) {
                currentUser.data = {
                    ...onboardingData,
                    onboardingComplete: true,
                    mode: userMode,
                    aiLevel: aiLevel,
                    dietQuality: dietQuality,
                    workouts: weeklyWorkouts,
                    preferences: foodPreferences
                };
                saveUserData();
            }

            // Save mode separately
            saveUserMode();

            // Show success message with mode confirmation
            const modeText = userMode === 'casual' ? 'Casual Mode' : `Pro Mode (${aiLevel === 'adjust' ? 'Adjust Existing Meals' : aiLevel === 'schedule' ? 'Build from Schedule' : 'Full AI Optimization'})`;
            const qualityText = dietQuality === 'performance' ? 'Performance-Focused' : dietQuality === 'budget' ? 'Budget-Friendly' : 'Premium Quality';
            alert(`🎉 Setup complete! You're all set with ${modeText} and ${qualityText} nutrition. Your personalized plan is ready!`);

            // Close onboarding and navigate to appropriate tab
            closeOnboarding();
            document.querySelector('[data-view="workouts"]')?.click();
        }

        function closeOnboarding() {
            document.getElementById('onboardingOverlay').classList.remove('active');
        }

        function populateMainFormFromOnboarding(data) {
            // Populate profile data
            if (data.profile.name) document.getElementById('userName').value = data.profile.name;
            if (data.profile.age) document.getElementById('userAge').value = data.profile.age;
            if (data.profile.weight) document.getElementById('userWeight').value = data.profile.weight;
            if (data.profile.height) document.getElementById('userHeight').value = data.profile.height;
            if (data.profile.goal) document.getElementById('fitnessGoal').value = data.profile.goal;
            if (data.profile.calories) document.getElementById('calorieTarget').value = data.profile.calories;
            if (data.profile.activity) document.getElementById('activityLevel').value = data.profile.activity;

            // Populate restrictions
            if (data.restrictions.allergies) document.getElementById('allergies').value = data.restrictions.allergies;

            // Populate shopping data
            if (data.shopping.store) document.getElementById('primaryStore').value = data.shopping.store;
            if (data.shopping.budgetType) document.getElementById('budgetType').value = data.shopping.budgetType;
            if (data.shopping.budget) document.getElementById('budgetAmount').value = data.shopping.budget;
            if (data.shopping.trips) document.getElementById('groceryTrips').value = data.shopping.trips;
            if (data.shopping.priority) document.getElementById('budgetPriority').value = data.shopping.priority;

            // Store food preferences
            foodPreferences.electrolytes = data.foodPreferences.electrolytes || [];
            foodPreferences.proteins = data.foodPreferences.proteins || [];
            foodPreferences.carbs = data.foodPreferences.carbs || [];
        }

        // Check if onboarding should be shown on page load
        document.addEventListener('DOMContentLoaded', () => {
            const onboardingComplete = localStorage.getItem('easyFuelOnboardingComplete');
            
            // For demo purposes, always show onboarding on first load
            // In production, you'd check: if (!onboardingComplete) { show onboarding }
            // Comment out the next line to disable onboarding after first visit
            // document.getElementById('onboardingOverlay').classList.remove('active');
        });

        // PWA Installation
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.className = 'btn';
        installButton.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: none; box-shadow: 0 4px 20px rgba(127, 232, 142, 0.4);';
        installButton.innerHTML = '📱 Install Easy Fuel';
        installButton.onclick = installPWA;
        document.body.appendChild(installButton);

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show install button
            installButton.style.display = 'block';
        });

        async function installPWA() {
            if (!deferredPrompt) {
                return;
            }
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                console.log('PWA installed');
            }
            deferredPrompt = null;
            installButton.style.display = 'none';
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Temporarily disabled for debugging
                // Uncomment when ready:
                /*
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
                */
            });
        }

        // iOS Install Instructions
        function showIOSInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator.standalone);
            
            if (isIOS && !isInStandaloneMode) {
                const iosPrompt = document.createElement('div');
                iosPrompt.style.cssText = `
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(135deg, #7FE88E 0%, #5DD46E 100%);
                    color: #0A0E1A;
                    padding: 1.5rem;
                    text-align: center;
                    z-index: 2000;
                    box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
                    font-family: 'Archivo', sans-serif;
                    animation: slideUpPrompt 0.5s ease;
                `;
                iosPrompt.innerHTML = `
                    <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.5rem;">📱 Install Easy Fuel</div>
                    <div style="font-size: 0.9rem; margin-bottom: 1rem;">
                        Tap <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" style="display: inline-block; vertical-align: middle; margin: 0 4px;">
                            <path d="M10 3l-1.5 1.5L11 7H3v2h8l-2.5 2.5L10 13l5-5-5-5z" transform="rotate(90 10 10)"/>
                        </svg> then "Add to Home Screen"
                    </div>
                    <button onclick="this.parentElement.remove()" style="background: rgba(10,14,26,0.8); color: white; border: none; padding: 0.5rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer;">Got it!</button>
                `;
                
                // Only show if not dismissed before
                if (!localStorage.getItem('iosInstallPromptDismissed')) {
                    document.body.appendChild(iosPrompt);
                    iosPrompt.querySelector('button').onclick = () => {
                        localStorage.setItem('iosInstallPromptDismissed', 'true');
                        iosPrompt.remove();
                    };
                }
            }
        }

        // Show iOS instructions after a short delay
        setTimeout(showIOSInstallInstructions, 3000);
// ========================================
// MEAL PLANNING ENGINE
// ========================================

// Calorie burn rates per minute for different activities
const calorieRates = {
    rest: { low: 0, moderate: 0, high: 0 },
    strength: { low: 4, moderate: 6, high: 8 },
    cardio: { low: 8, moderate: 11, high: 14 },
    hiit: { low: 10, moderate: 13, high: 16 },
    yoga: { low: 2, moderate: 3, high: 4 },
    sports: { low: 6, moderate: 9, high: 12 }
};

// Meal database with macro profiles
const mealDatabase = {
    breakfast: [
        { name: "Oatmeal Power Bowl", protein: 35, carbs: 85, fat: 22, calories: 650, ingredients: ["1 cup oats (cooked)", "1 scoop vanilla protein powder", "1 banana, sliced", "2 tbsp almond butter", "1 tbsp honey", "Cinnamon to taste"] },
        { name: "Greek Yogurt Parfait", protein: 40, carbs: 60, fat: 15, calories: 525, ingredients: ["2 cups Greek yogurt", "1 cup granola", "1 cup mixed berries", "2 tbsp honey", "1/4 cup walnuts"] },
        { name: "Egg White Scramble", protein: 45, carbs: 50, fat: 18, calories: 530, ingredients: ["8 egg whites", "2 whole eggs", "1 cup spinach", "1/2 cup mushrooms", "2 slices whole wheat toast", "1 tbsp olive oil"] },
        { name: "Protein Pancakes", protein: 42, carbs: 75, fat: 16, calories: 600, ingredients: ["1.5 cups pancake mix", "2 scoops protein powder", "2 eggs", "1/4 cup blueberries", "2 tbsp maple syrup"] },
        { name: "Breakfast Burrito", protein: 38, carbs: 70, fat: 24, calories: 640, ingredients: ["3 eggs", "1/4 cup black beans", "1 large tortilla", "1/4 cup cheese", "1/2 avocado", "Salsa"] }
    ],
    preWorkout: [
        { name: "Quick Energy Boost", protein: 8, carbs: 35, fat: 11, calories: 250, ingredients: ["1 medium apple", "2 tbsp peanut butter", "1 rice cake"] },
        { name: "Banana Smoothie", protein: 15, carbs: 45, fat: 6, calories: 290, ingredients: ["1 banana", "1 scoop whey protein", "1 cup almond milk", "1 tbsp honey"] },
        { name: "Energy Bar & Fruit", protein: 10, carbs: 40, fat: 8, calories: 260, ingredients: ["1 protein bar", "1 medium orange"] },
        { name: "Toast & Berries", protein: 12, carbs: 42, fat: 7, calories: 270, ingredients: ["2 slices whole wheat bread", "1 tbsp almond butter", "1/2 cup blueberries"] }
    ],
    postWorkout: [
        { name: "Chicken & Rice Recovery", protein: 62, carbs: 75, fat: 18, calories: 750, ingredients: ["8 oz grilled chicken breast", "1.5 cups white rice", "1 cup steamed broccoli", "1 tbsp olive oil"] },
        { name: "Protein Shake + Rice", protein: 55, carbs: 80, fat: 12, calories: 680, ingredients: ["2 scoops whey protein", "2 cups chocolate milk", "1 banana", "1 cup cooked rice"] },
        { name: "Turkey & Sweet Potato", protein: 58, carbs: 70, fat: 16, calories: 700, ingredients: ["8 oz ground turkey", "1 large sweet potato", "1 cup green beans", "1 tbsp coconut oil"] },
        { name: "Salmon & Quinoa", protein: 50, carbs: 65, fat: 22, calories: 720, ingredients: ["6 oz salmon", "1.5 cups quinoa", "1 cup asparagus", "Lemon & herbs"] }
    ],
    dinner: [
        { name: "Salmon with Sweet Potato", protein: 45, carbs: 55, fat: 28, calories: 700, ingredients: ["6 oz grilled salmon", "1 large sweet potato", "2 cups mixed greens salad", "2 tbsp avocado oil dressing"] },
        { name: "Lean Beef & Vegetables", protein: 52, carbs: 45, fat: 25, calories: 680, ingredients: ["7 oz lean beef", "1 cup brown rice", "2 cups mixed vegetables", "1 tbsp olive oil"] },
        { name: "Chicken Stir-Fry", protein: 48, carbs: 60, fat: 20, calories: 680, ingredients: ["7 oz chicken breast", "2 cups mixed vegetables", "1 cup rice noodles", "Stir-fry sauce"] },
        { name: "Shrimp & Pasta", protein: 42, carbs: 70, fat: 18, calories: 650, ingredients: ["6 oz shrimp", "1.5 cups whole wheat pasta", "1/2 cup marinara sauce", "2 cups spinach", "Parmesan cheese"] },
        { name: "Turkey Meatballs", protein: 50, carbs: 58, fat: 22, calories: 690, ingredients: ["8 oz turkey meatballs", "1.5 cups pasta", "1/2 cup tomato sauce", "Side salad"] }
    ],
    snacks: [
        { name: "Protein Shake", protein: 25, carbs: 8, fat: 3, calories: 160, ingredients: ["1 scoop whey protein", "1 cup water"] },
        { name: "Greek Yogurt & Berries", protein: 20, carbs: 25, fat: 5, calories: 225, ingredients: ["1 cup Greek yogurt", "1/2 cup mixed berries"] },
        { name: "Trail Mix", protein: 8, carbs: 28, fat: 18, calories: 290, ingredients: ["1/4 cup almonds", "1/4 cup dried fruit", "1 tbsp dark chocolate chips"] }
    ]
};

// Calculate BMR (Basal Metabolic Rate) using Mifflin-St Jeor Equation
function calculateBMR(weight, height, age, gender = 'male') {
    // weight in lbs, height in inches
    const weightKg = weight * 0.453592;
    const heightCm = height * 2.54;
    
    if (gender === 'male') {
        return (10 * weightKg) + (6.25 * heightCm) - (5 * age) + 5;
    } else {
        return (10 * weightKg) + (6.25 * heightCm) - (5 * age) - 161;
    }
}

// Calculate TDEE (Total Daily Energy Expenditure)
function calculateTDEE(bmr, activityLevel) {
    const multipliers = {
        sedentary: 1.2,
        light: 1.375,
        moderate: 1.55,
        active: 1.725,
        extreme: 1.9
    };
    return bmr * (multipliers[activityLevel] || 1.55);
}

// Calculate calories burned from workout
function calculateWorkoutCalories(type, duration, intensity) {
    if (!type || type === 'rest' || !duration) return 0;
    const rate = calorieRates[type]?.[intensity] || 5;
    return Math.round(rate * duration);
}

// Calculate macro split based on workout type and intensity
function calculateMacros(totalCalories, workoutType, intensity, mode) {
    let proteinPercent, carbsPercent, fatPercent;
    
    if (workoutType === 'rest') {
        // Rest day: moderate carbs, higher fat
        proteinPercent = 30;
        carbsPercent = 35;
        fatPercent = 35;
    } else if (workoutType === 'strength') {
        // Strength: high protein, moderate-high carbs
        proteinPercent = 35;
        carbsPercent = 40;
        fatPercent = 25;
    } else if (workoutType === 'cardio' || workoutType === 'hiit') {
        // Cardio/HIIT: high carbs for energy
        proteinPercent = 25;
        carbsPercent = 50;
        fatPercent = 25;
    } else {
        // Default split
        proteinPercent = 30;
        carbsPercent = 40;
        fatPercent = 30;
    }
    
    return {
        protein: Math.round((totalCalories * proteinPercent / 100) / 4), // 4 cal per g
        carbs: Math.round((totalCalories * carbsPercent / 100) / 4),     // 4 cal per g
        fat: Math.round((totalCalories * fatPercent / 100) / 9)          // 9 cal per g
    };
}

// Select meals to hit macro targets
function selectMeals(targetCalories, targetMacros, workoutType, hasWorkout) {
    const meals = {};
    
    // Allocate calories across meals
    const breakfastCals = Math.round(targetCalories * 0.28);
    const dinnerCals = Math.round(targetCalories * 0.30);
    
    let remainingCals = targetCalories - breakfastCals - dinnerCals;
    
    // Select breakfast
    meals.breakfast = selectBestMeal(mealDatabase.breakfast, breakfastCals, 100);
    
    if (hasWorkout) {
        // Add pre and post workout meals
        const preWorkoutCals = Math.round(targetCalories * 0.12);
        const postWorkoutCals = Math.round(targetCalories * 0.30);
        
        meals.preWorkout = selectBestMeal(mealDatabase.preWorkout, preWorkoutCals, 60);
        meals.postWorkout = selectBestMeal(mealDatabase.postWorkout, postWorkoutCals, 120);
        
        remainingCals = targetCalories - breakfastCals - preWorkoutCals - postWorkoutCals - dinnerCals;
    }
    
    // Select dinner
    meals.dinner = selectBestMeal(mealDatabase.dinner, dinnerCals, 100);
    
    // Add snack if needed for remaining calories
    if (remainingCals > 150) {
        meals.snack = selectBestMeal(mealDatabase.snacks, remainingCals, 100);
    }
    
    return meals;
}

// Helper: Select best meal match for calorie target
function selectBestMeal(mealOptions, targetCals, tolerance) {
    let bestMeal = mealOptions[0];
    let smallestDiff = Math.abs(mealOptions[0].calories - targetCals);
    
    for (const meal of mealOptions) {
        const diff = Math.abs(meal.calories - targetCals);
        if (diff < smallestDiff && diff <= tolerance) {
            bestMeal = meal;
            smallestDiff = diff;
        }
    }
    
    return bestMeal;
}

// Main function: Generate complete meal plan
function generateMealPlan() {
    console.log('🎯 Starting meal plan generation...');
    
    // Get user data
    if (!currentUser || !currentUser.data) {
        alert('Please complete your profile first!');
        return;
    }
    
    const weight = parseInt(currentUser.data.weight) || 165;
    const height = parseInt(currentUser.data.height) || 68;
    const age = parseInt(currentUser.data.age) || 28;
    
    // Calculate base metabolic rate
    const bmr = calculateBMR(weight, height, age);
    const tdee = calculateTDEE(bmr, 'moderate');
    
    console.log('📊 BMR:', bmr, 'TDEE:', tdee);
    
    // Collect weekly schedule
    const weekSchedule = {};
    const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
    
    days.forEach(day => {
        const type = document.getElementById(`${day}-type`)?.value || 'rest';
        const duration = parseInt(document.getElementById(`${day}-duration`)?.value) || 0;
        const intensity = document.getElementById(`${day}-intensity`)?.value || 'moderate';
        const description = document.getElementById(`${day}-description`)?.value || '';
        
        const workoutCalories = calculateWorkoutCalories(type, duration, intensity);
        const totalCalories = Math.round(tdee + workoutCalories);
        const macros = calculateMacros(totalCalories, type, intensity, userMode);
        
        weekSchedule[day] = {
            workout: {
                type,
                duration,
                intensity,
                description,
                calories: workoutCalories
            },
            nutrition: {
                totalCalories,
                ...macros
            },
            meals: selectMeals(totalCalories, macros, type, type !== 'rest')
        };
    });
    
    console.log('📅 Week schedule generated:', weekSchedule);
    
    // Save to user data
    currentUser.data.weekSchedule = weekSchedule;
    currentUser.data.mealPlanGenerated = true;
    currentUser.data.lastGenerated = new Date().toISOString();
    saveUserData();
    
    // Update Home tab with today's plan
    updateHomePage();
    
    // Show success notification
    showNotification('✅ Meal plan generated!', 'Check the Home tab to see today\'s meals');
    
    // Switch to Home tab
    setTimeout(() => {
        switchTab('setup');
    }, 1500);
}

// Update Home page with today's meal plan
function updateHomePage() {
    const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
    const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
    const todayName = dayNames[today];
    
    if (!currentUser?.data?.weekSchedule) return;
    
    const todayPlan = currentUser.data.weekSchedule[todayName];
    if (!todayPlan) return;
    
    console.log('📱 Updating home page with:', todayName, todayPlan);
    
    // Update workout card
    const workoutEl = document.getElementById('todayWorkout');
    if (workoutEl && todayPlan.workout.type !== 'rest') {
        workoutEl.innerHTML = `
            <div style="padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; text-transform: capitalize;">
                    ${todayPlan.workout.type.replace('hiit', 'HIIT')} ${todayPlan.workout.type === 'strength' ? 'Training' : ''}
                </div>
                <div style="color: var(--text-secondary); font-size: 0.9rem;">
                    ${todayPlan.workout.duration} minutes • ${todayPlan.workout.intensity} intensity • ~${todayPlan.workout.calories} calories
                </div>
                ${todayPlan.workout.description ? `<div style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.5rem; font-style: italic;">${todayPlan.workout.description}</div>` : ''}
            </div>
        `;
    } else if (workoutEl) {
        workoutEl.innerHTML = `
            <div style="padding: 1rem; background: var(--bg-dark); border-radius: 8px; text-align: center;">
                <div style="font-weight: 600; color: var(--primary);">Rest Day 😌</div>
                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">Recovery and regeneration</div>
            </div>
        `;
    }
    
    // Update meal cards
    const mealsEl = document.getElementById('todayMeals');
    if (!mealsEl) return;
    
    let mealsHTML = '';
    const mealIcons = {
        breakfast: '🌅',
        preWorkout: '⚡',
        postWorkout: '🍗',
        snack: '🍎',
        dinner: '🌙'
    };
    
    const mealTitles = {
        breakfast: 'Breakfast',
        preWorkout: 'Pre-Workout Snack',
        postWorkout: 'Post-Workout Meal',
        snack: 'Snack',
        dinner: 'Dinner'
    };
    
    Object.keys(todayPlan.meals).forEach(mealType => {
        const meal = todayPlan.meals[mealType];
        mealsHTML += `
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">${mealIcons[mealType] || '🍽️'}</div>
                    <h2 class="card-title">${mealTitles[mealType] || mealType}</h2>
                    <div style="margin-left: auto; font-family: 'JetBrains Mono', monospace; color: var(--primary); font-weight: 700;">
                        ${meal.calories} cal
                    </div>
                </div>
                <div style="padding: 1rem 0;">
                    <div style="margin-bottom: 1rem;">
                        <div style="font-weight: 600; font-size: 1.05rem; margin-bottom: 0.75rem;">${meal.name}</div>
                        <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8; margin: 0; padding-left: 1.5rem;">
                            ${meal.ingredients.map(ing => `<li>${ing}</li>`).join('')}
                        </ul>
                    </div>
                    <div style="display: flex; gap: 1.5rem; padding: 0.875rem; background: var(--bg-dark); border-radius: 8px; font-size: 0.95rem; font-family: 'JetBrains Mono', monospace;">
                        <div><strong style="color: var(--accent);">P:</strong> ${meal.protein}g</div>
                        <div><strong style="color: var(--accent-alt);">C:</strong> ${meal.carbs}g</div>
                        <div><strong style="color: var(--primary);">F:</strong> ${meal.fat}g</div>
                    </div>
                </div>
            </div>
        `;
    });
    
    mealsEl.innerHTML = mealsHTML;
    
    // Update daily totals
    const totals = {
        calories: todayPlan.nutrition.totalCalories,
        protein: todayPlan.nutrition.protein,
        carbs: todayPlan.nutrition.carbs,
        fat: todayPlan.nutrition.fat
    };
    
    document.querySelector('#setup .card:last-child').innerHTML = `
        <div class="card-header">
            <div class="card-icon">📊</div>
            <h2 class="card-title" style="color: var(--bg-dark);">Daily Totals</h2>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1.5rem; padding: 1rem 0;">
            <div style="text-align: center;">
                <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">CALORIES</div>
                <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">${totals.calories}</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">PROTEIN</div>
                <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">${totals.protein}g</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">CARBS</div>
                <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">${totals.carbs}g</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 0.75rem; color: rgba(10,14,26,0.6); font-weight: 600; margin-bottom: 0.25rem;">FATS</div>
                <div style="font-size: 2rem; font-weight: 700; color: var(--bg-dark); font-family: 'JetBrains Mono', monospace;">${totals.fat}g</div>
            </div>
        </div>
    `;
}

// Initialize schedule builder listeners
function initScheduleBuilder() {
    const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
    
    days.forEach(day => {
        const typeSelect = document.getElementById(`${day}-type`);
        if (typeSelect) {
            typeSelect.addEventListener('change', function() {
                const isRest = this.value === 'rest';
                const details = document.getElementById(`${day}-details`);
                const intensityGroup = document.getElementById(`${day}-intensity-group`);
                const descriptionGroup = document.getElementById(`${day}-description-group`);
                
                if (details) details.style.display = isRest ? 'none' : 'block';
                if (intensityGroup) intensityGroup.style.display = isRest ? 'none' : 'block';
                if (descriptionGroup) descriptionGroup.style.display = isRest ? 'none' : 'block';
            });
        }
    });
}

// Call this when page loads
document.addEventListener('DOMContentLoaded', () => {
    initScheduleBuilder();
    
    // If user has a meal plan, update home page
    if (currentUser?.data?.mealPlanGenerated) {
        updateHomePage();
    }
});
    </script>
    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="bottom-nav-container">
            <button class="bottom-nav-btn active" onclick="switchTab('setup')" data-tab="setup">
                <div class="nav-icon">🏠</div>
                <div>Home</div>
            </button>
            <button class="bottom-nav-btn" onclick="switchTab('shopping')" data-tab="shopping">
                <div class="nav-icon">🛒</div>
                <div>Groceries</div>
            </button>
            <button class="bottom-nav-btn" onclick="switchTab('workouts')" data-tab="workouts">
                <div class="nav-icon">📅</div>
                <div>Schedule</div>
            </button>
            <button class="bottom-nav-btn" onclick="switchTab('profile')" data-tab="profile">
                <div class="nav-icon">👤</div>
                <div>Profile</div>
            </button>
        </div>
    </nav>

</body>
</html>